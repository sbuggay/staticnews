<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1693386064689" as="style"/><link rel="stylesheet" href="styles.css?v=1693386064689"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.erk.dev/posts/anifont/">Bad Apple Font</a> <span class="domain">(<a href="https://blog.erk.dev">blog.erk.dev</a>)</span></div><div class="subtext"><span>notmysql_</span> | <span>28 comments</span></div><br/><div><div id="37317687" class="c"><input type="checkbox" id="c-37317687" checked=""/><div class="controls bullet"><span class="by">interroboink</span><span>|</span><a href="#37318583">next</a><span>|</span><label class="collapse" for="c-37317687">[-]</label><label class="expand" for="c-37317687">[1 more]</label></div><br/><div class="children"><div class="content">I thought somehow the animation was playing &quot;by itself,&quot; but I guess it was accomplished by holding down the &#x27;.&#x27; key? The font code swaps a run of N dots with the glyph corresponding to the Nth frame of animation.</div><br/></div></div><div id="37318583" class="c"><input type="checkbox" id="c-37318583" checked=""/><div class="controls bullet"><span class="by">gpvos</span><span>|</span><a href="#37317687">prev</a><span>|</span><a href="#37317176">next</a><span>|</span><label class="collapse" for="c-37318583">[-]</label><label class="expand" for="c-37318583">[4 more]</label></div><br/><div class="children"><div class="content">Okay, now you have the frames as glyphs in the font, but how are they going to animate? The most interesting part of the explanation is missing.</div><br/><div id="37319085" class="c"><input type="checkbox" id="c-37319085" checked=""/><div class="controls bullet"><span class="by">dan-robertson</span><span>|</span><a href="#37318583">parent</a><span>|</span><a href="#37318909">next</a><span>|</span><label class="collapse" for="c-37319085">[-]</label><label class="expand" for="c-37319085">[1 more]</label></div><br/><div class="children"><div class="content">The glyph corresponds to how many (e.g.) dots you have in a row and the author set key-repeat at 30&#x2F;s and held down the . key.</div><br/></div></div><div id="37318909" class="c"><input type="checkbox" id="c-37318909" checked=""/><div class="controls bullet"><span class="by">p4bl0</span><span>|</span><a href="#37318583">parent</a><span>|</span><a href="#37319085">prev</a><span>|</span><a href="#37318998">next</a><span>|</span><label class="collapse" for="c-37318909">[-]</label><label class="expand" for="c-37318909">[1 more]</label></div><br/><div class="children"><div class="content">I came here to ask the same thing, then saw interroboink&#x27;s guess in another comment and it seems plausible: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37317687">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37317687</a></div><br/></div></div><div id="37318998" class="c"><input type="checkbox" id="c-37318998" checked=""/><div class="controls bullet"><span class="by">jansan</span><span>|</span><a href="#37318583">parent</a><span>|</span><a href="#37318909">prev</a><span>|</span><a href="#37317176">next</a><span>|</span><label class="collapse" for="c-37318998">[-]</label><label class="expand" for="c-37318998">[1 more]</label></div><br/><div class="children"><div class="content">In the middle of the article you see a line &quot;RUST Full code for character replacement&quot;. If you click on that, it will show you the Wasm code.<p>It looks like it uses Wasm to replace a sequence of dots with a glyph from the font, which shows a frame from the animation, similar to ligatures, but using Wasm. You could do the same with storing the svg paths for each animation frame in an array and then using Javascript iterate over and display these paths, but this uses Wasm, HarfBuzz and a font.</div><br/></div></div></div></div><div id="37317176" class="c"><input type="checkbox" id="c-37317176" checked=""/><div class="controls bullet"><span class="by">triclops200</span><span>|</span><a href="#37318583">prev</a><span>|</span><a href="#37317769">next</a><span>|</span><label class="collapse" for="c-37317176">[-]</label><label class="expand" for="c-37317176">[6 more]</label></div><br/><div class="children"><div class="content">Obviously the thought comes up of the fact that this feels unsafe to have WASM in font files, but, I&#x27;m also aware that font layout engines are already turing complete, which leads me to wonder: have there been any high profile malware font examples? That entire stack feels a lot like an attack surface to me, especially given stuff like the fact that windows used to render fonts in the kernel layer.</div><br/><div id="37317710" class="c"><input type="checkbox" id="c-37317710" checked=""/><div class="controls bullet"><span class="by">saurik</span><span>|</span><a href="#37317176">parent</a><span>|</span><a href="#37318795">next</a><span>|</span><label class="collapse" for="c-37317710">[-]</label><label class="expand" for="c-37317710">[1 more]</label></div><br/><div class="children"><div class="content">Multiple iOS jailbreaks--both by comex--were buffer overflows of the virtual machine stack due to bugs in how a few instructions were handled in freetype&#x27;s implementation of true type font hinting. The resulting exploit was embedded in a PDF file (which was itself deployed by a website), but that was just a convenient way to embed the font and trigger very deterministic hinting: the bug wasn&#x27;t in the PDF renderer, per se (though I imagine a lot of people were confused on that front in the popular press about the issue).<p>He open sourced the exploit concurrent to the website going up, and it was immediately adjusted for use against different targets (including FoxIt reader or something like that on Windows), and as freetype was used by a lot of Linux distributions in addition to iOS I imagine it was used in a ton of malware (which might or might not have been &quot;high profile&quot;). I actually use those vulnerabilities as a case study in the ethical trade offs of open source weaponization in my talks.<p>(There were two such jailbreaks, as there were&#x2F;are separate implementations of two similar yet slightly different virtual machine versions, each of which had bugs that I remember to be related to the same fundamental mistake; and--as you can read about in another big thread on this website today, most developers think coming up with difficult abstractions isn&#x27;t worth their effort and would rather fix things by playing whack-a-mole.)</div><br/></div></div><div id="37318795" class="c"><input type="checkbox" id="c-37318795" checked=""/><div class="controls bullet"><span class="by">winternewt</span><span>|</span><a href="#37317176">parent</a><span>|</span><a href="#37317710">prev</a><span>|</span><a href="#37317324">next</a><span>|</span><label class="collapse" for="c-37318795">[-]</label><label class="expand" for="c-37318795">[1 more]</label></div><br/><div class="children"><div class="content">Font files already have embedded code for hinting. So while this might increase the attack surface somewhat, it was already there and I honestly trust wasm execution more than the severely underdocumented and poorly understood hinting VM.<p><a href="https:&#x2F;&#x2F;www.truetype-typography.com&#x2F;tthints.htm" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.truetype-typography.com&#x2F;tthints.htm</a></div><br/></div></div><div id="37317324" class="c"><input type="checkbox" id="c-37317324" checked=""/><div class="controls bullet"><span class="by">LukeShu</span><span>|</span><a href="#37317176">parent</a><span>|</span><a href="#37318795">prev</a><span>|</span><a href="#37317363">next</a><span>|</span><label class="collapse" for="c-37317324">[-]</label><label class="expand" for="c-37317324">[1 more]</label></div><br/><div class="children"><div class="content">Font layout engines are only Turing-complete if the stack is unbounded (to be fair: that&#x27;s true actual computers too: they&#x27;re not Turing-complete because they don&#x27;t have infinite RAM), and AFAIK the major font engines all impose a quite strict limit on the stack size.</div><br/></div></div><div id="37317363" class="c"><input type="checkbox" id="c-37317363" checked=""/><div class="controls bullet"><span class="by">chrisco255</span><span>|</span><a href="#37317176">parent</a><span>|</span><a href="#37317324">prev</a><span>|</span><a href="#37317367">next</a><span>|</span><label class="collapse" for="c-37317363">[-]</label><label class="expand" for="c-37317363">[1 more]</label></div><br/><div class="children"><div class="content">Wasm is sandboxed, so it&#x27;s not really any different than rendering a web view inside an app.<p>Note the author had to modify Gimp to get it to run the wasm. It&#x27;s not something most apps would allow just for font rendering.</div><br/></div></div><div id="37317367" class="c"><input type="checkbox" id="c-37317367" checked=""/><div class="controls bullet"><span class="by">Tagbert</span><span>|</span><a href="#37317176">parent</a><span>|</span><a href="#37317363">prev</a><span>|</span><a href="#37317769">next</a><span>|</span><label class="collapse" for="c-37317367">[-]</label><label class="expand" for="c-37317367">[1 more]</label></div><br/><div class="children"><div class="content">Something like that is the reason that most OSs have dropped support for Postscript Type 1 fonts.</div><br/></div></div></div></div><div id="37317769" class="c"><input type="checkbox" id="c-37317769" checked=""/><div class="controls bullet"><span class="by">thaliaarchi</span><span>|</span><a href="#37317176">prev</a><span>|</span><a href="#37318657">next</a><span>|</span><label class="collapse" for="c-37317769">[-]</label><label class="expand" for="c-37317769">[1 more]</label></div><br/><div class="children"><div class="content">The post also links to some examples of using Wasm to solve complex typographical problems, which I found interesting.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;harfbuzz&#x2F;harfbuzz-wasm-examples">https:&#x2F;&#x2F;github.com&#x2F;harfbuzz&#x2F;harfbuzz-wasm-examples</a></div><br/></div></div><div id="37318657" class="c"><input type="checkbox" id="c-37318657" checked=""/><div class="controls bullet"><span class="by">weinzierl</span><span>|</span><a href="#37317769">prev</a><span>|</span><a href="#37318698">next</a><span>|</span><label class="collapse" for="c-37318657">[-]</label><label class="expand" for="c-37318657">[1 more]</label></div><br/><div class="children"><div class="content">Cool idea. Something very similar is possible without WASM in the font renderer. I remember a font that displayed its own size, so it changed zooming in and out. I think you could adapt that to play a short animation.</div><br/></div></div><div id="37318698" class="c"><input type="checkbox" id="c-37318698" checked=""/><div class="controls bullet"><span class="by">skrebbel</span><span>|</span><a href="#37318657">prev</a><span>|</span><a href="#37317309">next</a><span>|</span><label class="collapse" for="c-37318698">[-]</label><label class="expand" for="c-37318698">[2 more]</label></div><br/><div class="children"><div class="content">Stupid question: Is this an entire blog post about an animated font without showing the animation in action, or does it simply not work on my device? (iOS 15) I’m not sure where to look.</div><br/><div id="37318817" class="c"><input type="checkbox" id="c-37318817" checked=""/><div class="controls bullet"><span class="by">urbandw311er</span><span>|</span><a href="#37318698">parent</a><span>|</span><a href="#37317309">next</a><span>|</span><label class="collapse" for="c-37318817">[-]</label><label class="expand" for="c-37318817">[1 more]</label></div><br/><div class="children"><div class="content">They posted a YouTube video near the end of the blog post showing the result. See:<p><a href="https:&#x2F;&#x2F;m.youtube.com&#x2F;watch?v=GF2sn2DXjlA">https:&#x2F;&#x2F;m.youtube.com&#x2F;watch?v=GF2sn2DXjlA</a></div><br/></div></div></div></div><div id="37317309" class="c"><input type="checkbox" id="c-37317309" checked=""/><div class="controls bullet"><span class="by">robotnikman</span><span>|</span><a href="#37318698">prev</a><span>|</span><a href="#37319044">next</a><span>|</span><label class="collapse" for="c-37317309">[-]</label><label class="expand" for="c-37317309">[3 more]</label></div><br/><div class="children"><div class="content">I always love a reference to Bad Apple</div><br/><div id="37318202" class="c"><input type="checkbox" id="c-37318202" checked=""/><div class="controls bullet"><span class="by">sphars</span><span>|</span><a href="#37317309">parent</a><span>|</span><a href="#37317878">next</a><span>|</span><label class="collapse" for="c-37318202">[-]</label><label class="expand" for="c-37318202">[1 more]</label></div><br/><div class="children"><div class="content">Even though I feel somewhat familiar with most Internet culture, I&#x27;ve never come across the Bad Apple meme, and I&#x27;ve just spent a good hour down the YouTube rabbit hole watching variations of Bad Apple. Fantastic stuff</div><br/></div></div><div id="37317878" class="c"><input type="checkbox" id="c-37317878" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#37317309">parent</a><span>|</span><a href="#37318202">prev</a><span>|</span><a href="#37319044">next</a><span>|</span><label class="collapse" for="c-37317878">[-]</label><label class="expand" for="c-37317878">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s a convenient double-reference, given Apple&#x27;s history of well-known font-rendering exploits: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=16177535">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=16177535</a></div><br/></div></div></div></div><div id="37319044" class="c"><input type="checkbox" id="c-37319044" checked=""/><div class="controls bullet"><span class="by">aurelien</span><span>|</span><a href="#37317309">prev</a><span>|</span><a href="#37318245">next</a><span>|</span><label class="collapse" for="c-37319044">[-]</label><label class="expand" for="c-37319044">[1 more]</label></div><br/><div class="children"><div class="content">You can also speak of their bad | in terminal</div><br/></div></div><div id="37318245" class="c"><input type="checkbox" id="c-37318245" checked=""/><div class="controls bullet"><span class="by">jansan</span><span>|</span><a href="#37319044">prev</a><span>|</span><a href="#37318967">next</a><span>|</span><label class="collapse" for="c-37318245">[-]</label><label class="expand" for="c-37318245">[3 more]</label></div><br/><div class="children"><div class="content">The blog post talks a lot about how he got the frames into the font, but very little about how the animation works.<p>AFAICT this is how it is done (edit: I am wrong, it uses Wasm):<p>- The frames of the video are simply stored as glyphs in the font<p>- There is a ligature mapping for sequences of dots to glyphs (for example &quot;.&quot; is mapped to glyph 1, &quot;..&quot; is mapped to glyph 2, &quot;...&quot; is mapped to glyph 3, etc.<p>- If you use the font in an editable part of the browser and hold the &quot;.&quot; key pressed, dots get added by autorepeat and a growing a sequence of dots is inserted. This sequence of dots is converted by the font&#x27;s ligature mapping to different animation frame glyphs, thus showing the animation.<p>I have no idea why WASM and HarfBuzz are needed (it should work in any modern browser without them), but it looks like a fun little experiment.</div><br/><div id="37318391" class="c"><input type="checkbox" id="c-37318391" checked=""/><div class="controls bullet"><span class="by">zerocrates</span><span>|</span><a href="#37318245">parent</a><span>|</span><a href="#37318967">next</a><span>|</span><label class="collapse" for="c-37318391">[-]</label><label class="expand" for="c-37318391">[2 more]</label></div><br/><div class="children"><div class="content">A new experimental feature of HarfBuzz allows the font to include WASM code for the shaper within the font itself. So the code shown in the post is inside the font and getting run &quot;live,&quot; rather than being something that generated or modified the ligature tables in the font file in advance.<p>I wondered myself about just using &quot;simple&quot; ligatures, but I don&#x27;t know whether or not it&#x27;s feasible to statically store several thousand ligature definitions in a font that are each mostly runs of several thousand characters being substituted. But maybe? OpenType has mysterious depths.</div><br/><div id="37318517" class="c"><input type="checkbox" id="c-37318517" checked=""/><div class="controls bullet"><span class="by">jansan</span><span>|</span><a href="#37318245">root</a><span>|</span><a href="#37318391">parent</a><span>|</span><a href="#37318967">next</a><span>|</span><label class="collapse" for="c-37318517">[-]</label><label class="expand" for="c-37318517">[1 more]</label></div><br/><div class="children"><div class="content">Should be no problem. GSUB lookup type 4.1* uses a uint16 to store the number of ligatures, so 65000 ligatures should be feasible. To store the actual glyphs, 32bit offsets are used, so you theoretically have a 2GByte of memory available, which should be plenty (although I have never seen a font larger than 15MB).<p>Using Wasm for this animation really is an overkill IMHO.<p>*)
<a href="https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;typography&#x2F;opentype&#x2F;spec&#x2F;gsub#lookuptype-4-ligature-substitution-subtable" rel="nofollow noreferrer">https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;typography&#x2F;opentype&#x2F;spec&#x2F;g...</a><p>Edit: IIRC Ligatures are applied recursively, so you can have a ligature based on other ligatures. If I am right here, each ligature can consist only of two glyphs (the glyph of the previous animation frame followed by a dot). This would keep the GSUB table small.</div><br/></div></div></div></div></div></div><div id="37317874" class="c"><input type="checkbox" id="c-37317874" checked=""/><div class="controls bullet"><span class="by">snvzz</span><span>|</span><a href="#37318967">prev</a><span>|</span><label class="collapse" for="c-37317874">[-]</label><label class="expand" for="c-37317874">[4 more]</label></div><br/><div class="children"><div class="content">It shows how current font rendering systems have accumulated quite a bit of bloat.<p>This makes me nostalgic for bitmap fonts.</div><br/><div id="37319304" class="c"><input type="checkbox" id="c-37319304" checked=""/><div class="controls bullet"><span class="by">lynguist</span><span>|</span><a href="#37317874">parent</a><span>|</span><a href="#37318054">next</a><span>|</span><label class="collapse" for="c-37319304">[-]</label><label class="expand" for="c-37319304">[1 more]</label></div><br/><div class="children"><div class="content">The goal is to print with a computer something like a late 15th century humanist document, a tradition of typography 500 years old, and not to print on a 200x320 screen, which had a tradition of merely a decade.<p>The early computer age of the 80s and 90s was merely playing catch-up to established standards. The standards of the 80s and 90s are not what we wanted to achieve ultimately.<p>Same with cinema: We shot on 4K-equivalent film for the past 100 years, only in the 80s and 90s with the computerization and videotapes we had a temporary standard of 480i, which we have overcome with sheer computer power, and we’re back to where we actually wanted to be in the beginning.</div><br/></div></div><div id="37318054" class="c"><input type="checkbox" id="c-37318054" checked=""/><div class="controls bullet"><span class="by">ryanwhitney</span><span>|</span><a href="#37317874">parent</a><span>|</span><a href="#37319304">prev</a><span>|</span><a href="#37317993">next</a><span>|</span><label class="collapse" for="c-37318054">[-]</label><label class="expand" for="c-37318054">[1 more]</label></div><br/><div class="children"><div class="content">I don’t think this is really bloat.<p>Opentype supported ligatures in ‘96. Postscript Type 1 and even Knuth’s TeX supported ligatures to a certain extent.<p>It’s a pretty standard base-level feature for any sort of typesetting.<p>Imo this is akin to making a terminal animation by outputting blocks of ascii art. It’s not that terminals added video playback support— which would be bloat—but instead someone pushed a standard feature to a novel extent.</div><br/></div></div></div></div></div></div></div></div></div></body></html>