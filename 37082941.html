<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1691744463831" as="style"/><link rel="stylesheet" href="styles.css?v=1691744463831"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.sqlite.org/json1.html">SQLite Functions for Working with JSON</a> <span class="domain">(<a href="https://www.sqlite.org">www.sqlite.org</a>)</span></div><div class="subtext"><span>mikece</span> | <span>26 comments</span></div><br/><div><div id="37083561" class="c"><input type="checkbox" id="c-37083561" checked=""/><div class="controls bullet"><span class="by">bambax</span><span>|</span><a href="#37085954">next</a><span>|</span><label class="collapse" for="c-37083561">[-]</label><label class="expand" for="c-37083561">[9 more]</label></div><br/><div class="children"><div class="content">The cool thing for working with json is to store each json document as is in one column, then make virtual columns that store some specific information you want to query, using some combination of json_extract, then index those columns.<p>This makes for super-fast search, and the best part is you don&#x27;t have to choose what to index at insert time; you can always make more virtual columns when you need them.<p>(You can still also search non-indexed, raw json, although it may take a long time for large collections).<p>I love SQLite so much.</div><br/><div id="37083936" class="c"><input type="checkbox" id="c-37083936" checked=""/><div class="controls bullet"><span class="by">laurencerowe</span><span>|</span><a href="#37083561">parent</a><span>|</span><a href="#37084481">next</a><span>|</span><label class="collapse" for="c-37083936">[-]</label><label class="expand" for="c-37083936">[4 more]</label></div><br/><div class="children"><div class="content">It&#x27;s a shame SQLite doesn&#x27;t support indexing arbitrary JSON data similar to Postgres. This works by hashing the paths and values within each JSON doc (or just the paths if you choose json_path_ops which you probably should.) <a href="https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;datatype-json.html#JSON-INDEXING" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;datatype-json.html#J...</a><p>Unfortunately I don&#x27;t think SQLite has generalized support for multi valued indices, though perhaps it would be possible to implement using the virtual table mechanism like full text search. <a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;fts5.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.sqlite.org&#x2F;fts5.html</a></div><br/><div id="37084177" class="c"><input type="checkbox" id="c-37084177" checked=""/><div class="controls bullet"><span class="by">chunkyks</span><span>|</span><a href="#37083561">root</a><span>|</span><a href="#37083936">parent</a><span>|</span><a href="#37084481">next</a><span>|</span><label class="collapse" for="c-37084177">[-]</label><label class="expand" for="c-37084177">[3 more]</label></div><br/><div class="children"><div class="content">Not in precisely the way you mean, but that can be done: <a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;expridx.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.sqlite.org&#x2F;expridx.html</a></div><br/><div id="37085571" class="c"><input type="checkbox" id="c-37085571" checked=""/><div class="controls bullet"><span class="by">hans_castorp</span><span>|</span><a href="#37083561">root</a><span>|</span><a href="#37084177">parent</a><span>|</span><a href="#37084577">next</a><span>|</span><label class="collapse" for="c-37085571">[-]</label><label class="expand" for="c-37085571">[1 more]</label></div><br/><div class="children"><div class="content">But you need to know in advance which keys&#x2F;paths you want to index.<p>Postgres can index the entire JSON document (or parts of it) and they can support unknown query condition (e.g. using a JSON path). This isn&#x27;t as fast as a proper B-Tree index, but still faster than a full table scan.</div><br/></div></div><div id="37084577" class="c"><input type="checkbox" id="c-37084577" checked=""/><div class="controls bullet"><span class="by">Hakkin</span><span>|</span><a href="#37083561">root</a><span>|</span><a href="#37084177">parent</a><span>|</span><a href="#37085571">prev</a><span>|</span><a href="#37084481">next</a><span>|</span><label class="collapse" for="c-37084577">[-]</label><label class="expand" for="c-37084577">[1 more]</label></div><br/><div class="children"><div class="content">I think the limiting factor is that there&#x27;s no way to split the single JSON document out into all its paths and values in a way that SQLite can index it. There&#x27;s `json_each` and `json_tree` but there&#x27;s no way to generate a (dynamic) table using these functions that you could then index, as far as I know.<p>I believe this could probably be done using a trigger on document insert, but that would involve actually inserting each path and value into it&#x27;s own table, rather than SQLite generating it on the fly, so it would likely more than double the storage requirement and require inserting potentially hundreds of rows for each document, depending on what your original document structure looks like.</div><br/></div></div></div></div></div></div><div id="37084481" class="c"><input type="checkbox" id="c-37084481" checked=""/><div class="controls bullet"><span class="by">noman-land</span><span>|</span><a href="#37083561">parent</a><span>|</span><a href="#37083936">prev</a><span>|</span><a href="#37085954">next</a><span>|</span><label class="collapse" for="c-37084481">[-]</label><label class="expand" for="c-37084481">[4 more]</label></div><br/><div class="children"><div class="content">Neat idea. I&#x27;ve been deep diving into sqlite the past few months and it&#x27;s gotta be one of my favorite projects ever.<p>Got any other neat sqlite things or resources I might check out?</div><br/><div id="37084818" class="c"><input type="checkbox" id="c-37084818" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#37083561">root</a><span>|</span><a href="#37084481">parent</a><span>|</span><a href="#37084607">next</a><span>|</span><label class="collapse" for="c-37084818">[-]</label><label class="expand" for="c-37084818">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve baked a ton of different SQLite tricks - including things like full-text indexing support and advanced alter table methods - into my sqlite-utils CLI tool and Python library: <a href="https:&#x2F;&#x2F;sqlite-utils.datasette.io" rel="nofollow noreferrer">https:&#x2F;&#x2F;sqlite-utils.datasette.io</a><p>My Datasette project provides tools for exploring, analyzing and publishing SQLite databases, plus ways to expose them via a JSON API: <a href="https:&#x2F;&#x2F;datasette.io" rel="nofollow noreferrer">https:&#x2F;&#x2F;datasette.io</a><p>I&#x27;ve also written a ton of stuff about SQLite on my two blogs:<p>- <a href="https:&#x2F;&#x2F;simonwillison.net&#x2F;tags&#x2F;sqlite&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;simonwillison.net&#x2F;tags&#x2F;sqlite&#x2F;</a><p>- <a href="https:&#x2F;&#x2F;til.simonwillison.net&#x2F;sqlite" rel="nofollow noreferrer">https:&#x2F;&#x2F;til.simonwillison.net&#x2F;sqlite</a></div><br/><div id="37086006" class="c"><input type="checkbox" id="c-37086006" checked=""/><div class="controls bullet"><span class="by">jamietanna</span><span>|</span><a href="#37083561">root</a><span>|</span><a href="#37084818">parent</a><span>|</span><a href="#37084607">next</a><span>|</span><label class="collapse" for="c-37086006">[-]</label><label class="expand" for="c-37086006">[1 more]</label></div><br/><div class="children"><div class="content">Your excellent work around SQLite led me to building <a href="https:&#x2F;&#x2F;dmd.tanna.dev" rel="nofollow noreferrer">https:&#x2F;&#x2F;dmd.tanna.dev</a> and some other projects with it recently, and it&#x27;s been such a game changer for me, so thank you</div><br/></div></div></div></div><div id="37084607" class="c"><input type="checkbox" id="c-37084607" checked=""/><div class="controls bullet"><span class="by">nattaylor</span><span>|</span><a href="#37083561">root</a><span>|</span><a href="#37084481">parent</a><span>|</span><a href="#37084818">prev</a><span>|</span><a href="#37085954">next</a><span>|</span><label class="collapse" for="c-37084607">[-]</label><label class="expand" for="c-37084607">[1 more]</label></div><br/><div class="children"><div class="content">I think this parquet virtual table extension is a pretty neat example of the power of extension <a href="https:&#x2F;&#x2F;cldellow.com&#x2F;2018&#x2F;06&#x2F;22&#x2F;sqlite-parquet-vtable.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;cldellow.com&#x2F;2018&#x2F;06&#x2F;22&#x2F;sqlite-parquet-vtable.html</a></div><br/></div></div></div></div></div></div><div id="37085954" class="c"><input type="checkbox" id="c-37085954" checked=""/><div class="controls bullet"><span class="by">jamietanna</span><span>|</span><a href="#37083561">prev</a><span>|</span><a href="#37083501">next</a><span>|</span><label class="collapse" for="c-37085954">[-]</label><label class="expand" for="c-37085954">[1 more]</label></div><br/><div class="children"><div class="content">I ended up writing <a href="https:&#x2F;&#x2F;www.jvt.me&#x2F;posts&#x2F;2023&#x2F;03&#x2F;13&#x2F;sqlite-json&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.jvt.me&#x2F;posts&#x2F;2023&#x2F;03&#x2F;13&#x2F;sqlite-json&#x2F;</a> as a quick reference for myself, as I found I needed something more copy-paste able for my own needs, as well as the official docs</div><br/></div></div><div id="37083501" class="c"><input type="checkbox" id="c-37083501" checked=""/><div class="controls bullet"><span class="by">justin_oaks</span><span>|</span><a href="#37085954">prev</a><span>|</span><a href="#37085738">next</a><span>|</span><label class="collapse" for="c-37083501">[-]</label><label class="expand" for="c-37083501">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been working with JSON in SQLite lately for backing up a bunch of data from an API that returns JSON.<p>The JSON functions work well for basic usage. And I&#x27;m so glad that the -&gt; and -&gt;&gt; operators were added since it makes the syntax so much shorter than using the json_extract() function.  I&#x27;d say SQLite works with JSON as well as the other databases mentioned: Postgres and MySQL.<p>My big wish is that we could get something as advanced as jq for use in manipulating JSON. The JSON path language used for extracting JSON is very basic.<p>Alas, I probably am asking for too much for a relational database to support advanced JSON manipulation too. You can do a fair amount of JSON manipulation by extracting the data to a tabular format and using SQL to do the manipulation from there.</div><br/><div id="37083806" class="c"><input type="checkbox" id="c-37083806" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#37083501">parent</a><span>|</span><a href="#37083652">next</a><span>|</span><label class="collapse" for="c-37083806">[-]</label><label class="expand" for="c-37083806">[2 more]</label></div><br/><div class="children"><div class="content">Since SQLite supports custom SQL functions, you can add JQ support to it pretty easily.<p>I just threw together a plugin for my sqlite-utils CLI tool that adds a jq() function here:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;simonw&#x2F;sqlite-utils-jq">https:&#x2F;&#x2F;github.com&#x2F;simonw&#x2F;sqlite-utils-jq</a><p>Use it like this:<p><pre><code>    sqlite-utils memory &quot;select jq(:doc, :expr) as result&quot; \
      -p doc &#x27;{&quot;foo&quot;: &quot;bar&quot;}&#x27; \
      -p expr &#x27;.foo&#x27; \
      --table
</code></pre>
Or install sqlite-utils-litecli from <a href="https:&#x2F;&#x2F;github.com&#x2F;simonw&#x2F;sqlite-utils-litecli">https:&#x2F;&#x2F;github.com&#x2F;simonw&#x2F;sqlite-utils-litecli</a> to get an interactive shell that can use the new function:<p><pre><code>    brew install sqlite-utils
    sqlite-utils install sqlite-utils-litecli sqlite-utils-jq
    sqlite-utils litecli data.db
    # ...
    Version: 1.9.0
    Mail: https:&#x2F;&#x2F;groups.google.com&#x2F;forum&#x2F;#!forum&#x2F;litecli-users
    GitHub: https:&#x2F;&#x2F;github.com&#x2F;dbcli&#x2F;litecli
    data.db&gt; select jq(&#x27;{&quot;foo&quot;: &quot;bar&quot;}&#x27;, &#x27;.foo&#x27;)
    +------------------------------+
    | jq(&#x27;{&quot;foo&quot;: &quot;bar&quot;}&#x27;, &#x27;.foo&#x27;) |
    +------------------------------+
    | &quot;bar&quot;                        |
    +------------------------------+
    1 row in set
    Time: 0.031s</code></pre></div><br/><div id="37084802" class="c"><input type="checkbox" id="c-37084802" checked=""/><div class="controls bullet"><span class="by">justin_oaks</span><span>|</span><a href="#37083501">root</a><span>|</span><a href="#37083806">parent</a><span>|</span><a href="#37083652">next</a><span>|</span><label class="collapse" for="c-37084802">[-]</label><label class="expand" for="c-37084802">[1 more]</label></div><br/><div class="children"><div class="content">Wow! That&#x27;s cool. Thanks!</div><br/></div></div></div></div></div></div><div id="37085738" class="c"><input type="checkbox" id="c-37085738" checked=""/><div class="controls bullet"><span class="by">dumdumchan</span><span>|</span><a href="#37083501">prev</a><span>|</span><a href="#37083761">next</a><span>|</span><label class="collapse" for="c-37085738">[-]</label><label class="expand" for="c-37085738">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  Experiments have been unable to find a binary encoding that is smaller or faster than a plain text encoding<p>Why does postgres do it then?</div><br/></div></div><div id="37083761" class="c"><input type="checkbox" id="c-37083761" checked=""/><div class="controls bullet"><span class="by">dmezzetti</span><span>|</span><a href="#37085738">prev</a><span>|</span><a href="#37084744">next</a><span>|</span><label class="collapse" for="c-37083761">[-]</label><label class="expand" for="c-37083761">[1 more]</label></div><br/><div class="children"><div class="content">The built-in JSON functionality is very powerful. txtai (<a href="https:&#x2F;&#x2F;github.com&#x2F;neuml&#x2F;txtai">https:&#x2F;&#x2F;github.com&#x2F;neuml&#x2F;txtai</a>) takes full advantage of it and stores all relational data as JSON in SQLite.<p>The ability to build indexes on these JSON functions is important. Found this article to be a good reference: <a href="https:&#x2F;&#x2F;www.delphitools.info&#x2F;2021&#x2F;06&#x2F;17&#x2F;sqlite-as-a-no-sql-database&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.delphitools.info&#x2F;2021&#x2F;06&#x2F;17&#x2F;sqlite-as-a-no-sql-d...</a></div><br/></div></div><div id="37084744" class="c"><input type="checkbox" id="c-37084744" checked=""/><div class="controls bullet"><span class="by">fbdab103</span><span>|</span><a href="#37083761">prev</a><span>|</span><a href="#37084324">next</a><span>|</span><label class="collapse" for="c-37084744">[-]</label><label class="expand" for="c-37084744">[2 more]</label></div><br/><div class="children"><div class="content">Probably expands the API too much, but one missed use case I just ran into would be a .import function for loading a json list of records or jsonl directly into a table from the command line. This can be roughly replicated through readfile and some juggling, but will not work from stdin (I think? I would love to pipe json directly into a table).<p>The other alternative I considered was dumping the entire json blob into a one row table, before having a second query extract out the fields.</div><br/><div id="37084828" class="c"><input type="checkbox" id="c-37084828" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#37084744">parent</a><span>|</span><a href="#37084324">next</a><span>|</span><label class="collapse" for="c-37084828">[-]</label><label class="expand" for="c-37084828">[1 more]</label></div><br/><div class="children"><div class="content">My sqlite-utils tool can pipe JSON directly into a SQLite table, creating a table with the right schema if it doesn&#x27;t exist yet: <a href="https:&#x2F;&#x2F;sqlite-utils.datasette.io&#x2F;en&#x2F;stable&#x2F;cli.html#inserting-json-data" rel="nofollow noreferrer">https:&#x2F;&#x2F;sqlite-utils.datasette.io&#x2F;en&#x2F;stable&#x2F;cli.html#inserti...</a></div><br/></div></div></div></div><div id="37084324" class="c"><input type="checkbox" id="c-37084324" checked=""/><div class="controls bullet"><span class="by">fcoury</span><span>|</span><a href="#37084744">prev</a><span>|</span><a href="#37084255">next</a><span>|</span><label class="collapse" for="c-37084324">[-]</label><label class="expand" for="c-37084324">[2 more]</label></div><br/><div class="children"><div class="content">I started working in a MongoDB wire protocol adapter layer to a PostgreSQL backend and it relies heavily on the use of JSON functions.<p>I was really wanting to also allow for SQLite as a backend but not sure if we can do everything that can be done in Postgres. If anyone want to take a look and colaborate on that, here’s a link to the project:<p><a href="https:&#x2F;&#x2F;oxidedb.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;oxidedb.com</a><p>And a quick ui for a quick try:<p><a href="https:&#x2F;&#x2F;demo.oxidedb.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;demo.oxidedb.com</a></div><br/><div id="37084767" class="c"><input type="checkbox" id="c-37084767" checked=""/><div class="controls bullet"><span class="by">grrdotcloud</span><span>|</span><a href="#37084324">parent</a><span>|</span><a href="#37084255">next</a><span>|</span><label class="collapse" for="c-37084767">[-]</label><label class="expand" for="c-37084767">[1 more]</label></div><br/><div class="children"><div class="content">Not resolving or responding. Kick it?</div><br/></div></div></div></div><div id="37084255" class="c"><input type="checkbox" id="c-37084255" checked=""/><div class="controls bullet"><span class="by">Dig1t</span><span>|</span><a href="#37084324">prev</a><span>|</span><a href="#37083112">next</a><span>|</span><label class="collapse" for="c-37084255">[-]</label><label class="expand" for="c-37084255">[2 more]</label></div><br/><div class="children"><div class="content">I wrote a gnarly migration using this API once. Involved extracting deeply nested json objects, conditionally transforming the values, and storing them in a new column. I wrote that migration and never touched it again and was always afraid to go back and mess with it because it was so hard to reason about.<p>This API is extremely useful but I would definitely recommend caution in its use, because it’s very easy to write a giant SQL statement that’s very powerful but impossible to read.</div><br/><div id="37084841" class="c"><input type="checkbox" id="c-37084841" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#37084255">parent</a><span>|</span><a href="#37083112">next</a><span>|</span><label class="collapse" for="c-37084841">[-]</label><label class="expand" for="c-37084841">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve found the trick for that kind of thing is to write automated tests for it - I sometimes write a set of pytest tests to exercise complex SQLite queries<p>Gives me way more confidence in them, and means I can change them later and feel confident I haven&#x27;t broken them.</div><br/></div></div></div></div></div></div></div></div></div></body></html>