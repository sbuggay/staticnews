<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1706864456339" as="style"/><link rel="stylesheet" href="styles.css?v=1706864456339"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://tembo.io/blog/tembo-data-warehouse">We built our customer data warehouse all on Postgres</a> <span class="domain">(<a href="https://tembo.io">tembo.io</a>)</span></div><div class="subtext"><span>samaysharma</span> | <span>23 comments</span></div><br/><div><div id="39225945" class="c"><input type="checkbox" id="c-39225945" checked=""/><div class="controls bullet"><span class="by">aurareturn</span><span>|</span><a href="#39226461">next</a><span>|</span><label class="collapse" for="c-39225945">[-]</label><label class="expand" for="c-39225945">[16 more]</label></div><br/><div class="children"><div class="content">Postgres is great but using pg_cron as your system to pull and clean data is a recipe for disaster in the long run. I&#x27;ve always regretted using complicated Postgres queries or functions instead of doing it in server. Sometimes I do it because I think &quot;wow, I didn&#x27;t know pg can do this. So cool, let&#x27;s just use it!&quot;. Regret. Every time. They&#x27;re too finicky, hard to test, and doesn&#x27;t have the ecosystem like git and IDEs to make changes easily. And the next employee won&#x27;t know about some random but crucial logic that lives inside Postgres instead of the code.<p>You&#x27;re also relying on your Postgres instance&#x27;s precious CPU&#x2F;RAM&#x2F;network to do logic work which can be unpredictable. Let&#x27;s be honest, most managed cloud Postgres providers charge an arm and a leg for big Postgres instances already. Why use those expensive resources when you can get a cheap EC2 instance or a serverless function to do the same and have the ability to scale efficiently?<p>My general rule is, use Postgres to store as much of my data as possible, but never use Postgres to do anything other than be a data store.<p>This rule of mine is why I never fell in love with Supabase even though many developers have. Use Postgres as my permissions layer? As my API server? You have to be kidding. If you&#x27;re building a quick throwaway prototype, maybe. (The rest of Supabase is really nice though).<p>PS. To the team at tembo, no one is going to sign up for a free trial without a pricing page.</div><br/><div id="39226598" class="c"><input type="checkbox" id="c-39226598" checked=""/><div class="controls bullet"><span class="by">baq</span><span>|</span><a href="#39225945">parent</a><span>|</span><a href="#39226105">next</a><span>|</span><label class="collapse" for="c-39226598">[-]</label><label class="expand" for="c-39226598">[1 more]</label></div><br/><div class="children"><div class="content">Yeah except for serious data warehouses there&#x27;s so much data you have to bring the compute in because getting data out is infeasible.<p>If that&#x27;s not the case, you aren&#x27;t running a data warehouse, just a (big, maybe) database.</div><br/></div></div><div id="39226105" class="c"><input type="checkbox" id="c-39226105" checked=""/><div class="controls bullet"><span class="by">codeflo</span><span>|</span><a href="#39225945">parent</a><span>|</span><a href="#39226598">prev</a><span>|</span><a href="#39226505">next</a><span>|</span><label class="collapse" for="c-39226105">[-]</label><label class="expand" for="c-39226105">[12 more]</label></div><br/><div class="children"><div class="content">&gt; no unit testing<p>I also prefer to do stuff on the server because doing things in the database does invariably seem to drift towards a confusing, brittle mess. However, I do wonder if that&#x27;s necessarily the case or just a limitation of our frameworks. There&#x27;s no principle that would prevent someone from setting up a simple test suite for database code. It would be a lot of work, but maybe there&#x27;s an architecture nirvana right in front of our eyes if someone just were to properly engineer a good framework around Postgres functions.</div><br/><div id="39226581" class="c"><input type="checkbox" id="c-39226581" checked=""/><div class="controls bullet"><span class="by">sverhagen</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226105">parent</a><span>|</span><a href="#39226146">next</a><span>|</span><label class="collapse" for="c-39226581">[-]</label><label class="expand" for="c-39226581">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s maybe no standard solution which could drive this forward as a practice, the way JUnit has taken on the Java community (I&#x27;m sure there are examples like that everywhere that may resonate). But nothing is stopping you from running Postgres in a Docker container, and wrap it in a unit test with the technology of your choice. The Postgres scripts (ddl, triggers, functions) could live in the same project. Setup, run tests, teardown. Each unit test can set up the data for a particular test case. That way you also codify the Postgres scripts, for which it then becomes &quot;just&quot; a deployment matter to get them from Git into the target environment. I have written all sorts of test harnesses, and I wish more people would think out of the box of their standard tool sets. Sure, I&#x27;m a Java developer, or one could be a SQL coder, but nothing is stopping us from writing a darn script.<p>(By the way, I&#x27;m not suggesting running a large data warehouse in a unit test. But the parents said &quot;unit testing&quot;, which suggests there exist units of smaller, isolated functionality in your project, if you&#x27;re willing to find them.)</div><br/></div></div><div id="39226146" class="c"><input type="checkbox" id="c-39226146" checked=""/><div class="controls bullet"><span class="by">aurareturn</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226105">parent</a><span>|</span><a href="#39226581">prev</a><span>|</span><a href="#39226154">next</a><span>|</span><label class="collapse" for="c-39226146">[-]</label><label class="expand" for="c-39226146">[5 more]</label></div><br/><div class="children"><div class="content">There&#x27;s no IDE that can detect Postgres coding errors, no refactoring support, no Git integration.<p>A lot of the ecosystem has to be built out for me to want to use Postgres functions. The benefit is not there.</div><br/><div id="39226295" class="c"><input type="checkbox" id="c-39226295" checked=""/><div class="controls bullet"><span class="by">codesnik</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226146">parent</a><span>|</span><a href="#39226601">next</a><span>|</span><label class="collapse" for="c-39226295">[-]</label><label class="expand" for="c-39226295">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve made some automatic schema dumping scripts for supabase&#x2F;postgres code to become searchable and git-diffable and PR-friendly. And I eventually was able to make unit testing to work good enough that I even wrote migrations in a test-first way, it was just quicker to iterate. But overall experience felt like I&#x27;m constantly combating problems, solved looong time ago for other languages and ecosystems. It was weirdly fun, but what killed my interest is that row level security policies kill performance of even simple queries so much, and EXPLAIN doesn&#x27;t help to well with it.</div><br/><div id="39226628" class="c"><input type="checkbox" id="c-39226628" checked=""/><div class="controls bullet"><span class="by">nextaccountic</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226295">parent</a><span>|</span><a href="#39226601">next</a><span>|</span><label class="collapse" for="c-39226628">[-]</label><label class="expand" for="c-39226628">[1 more]</label></div><br/><div class="children"><div class="content">Is it on github?</div><br/></div></div></div></div><div id="39226601" class="c"><input type="checkbox" id="c-39226601" checked=""/><div class="controls bullet"><span class="by">sverhagen</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226146">parent</a><span>|</span><a href="#39226295">prev</a><span>|</span><a href="#39226292">next</a><span>|</span><label class="collapse" for="c-39226601">[-]</label><label class="expand" for="c-39226601">[1 more]</label></div><br/><div class="children"><div class="content">Have you tried IntelliJ? I honestly do most of my SQL in psql, out of habit. But I&#x27;m in IntelliJ all the time for Java, and from what I&#x27;ve seen their query editor is way impressive.</div><br/></div></div><div id="39226292" class="c"><input type="checkbox" id="c-39226292" checked=""/><div class="controls bullet"><span class="by">maxbond</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226146">parent</a><span>|</span><a href="#39226601">prev</a><span>|</span><a href="#39226154">next</a><span>|</span><label class="collapse" for="c-39226292">[-]</label><label class="expand" for="c-39226292">[1 more]</label></div><br/><div class="children"><div class="content">This is a big problem, but I am encouraged by this project. <a href="https:&#x2F;&#x2F;github.com&#x2F;supabase&#x2F;postgres_lsp">https:&#x2F;&#x2F;github.com&#x2F;supabase&#x2F;postgres_lsp</a></div><br/></div></div></div></div><div id="39226154" class="c"><input type="checkbox" id="c-39226154" checked=""/><div class="controls bullet"><span class="by">csnweb</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226105">parent</a><span>|</span><a href="#39226146">prev</a><span>|</span><a href="#39226505">next</a><span>|</span><label class="collapse" for="c-39226154">[-]</label><label class="expand" for="c-39226154">[5 more]</label></div><br/><div class="children"><div class="content">There are tools for Postgres unit testing <a href="https:&#x2F;&#x2F;wiki.postgresql.org&#x2F;wiki&#x2F;Test_Frameworks" rel="nofollow">https:&#x2F;&#x2F;wiki.postgresql.org&#x2F;wiki&#x2F;Test_Frameworks</a>. Which is not to say there isn’t any room for improving them.</div><br/><div id="39226256" class="c"><input type="checkbox" id="c-39226256" checked=""/><div class="controls bullet"><span class="by">aurareturn</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226154">parent</a><span>|</span><a href="#39226505">next</a><span>|</span><label class="collapse" for="c-39226256">[-]</label><label class="expand" for="c-39226256">[4 more]</label></div><br/><div class="children"><div class="content">Write more Postgres functions to unit test Postgres functions. :))</div><br/><div id="39226282" class="c"><input type="checkbox" id="c-39226282" checked=""/><div class="controls bullet"><span class="by">maxbond</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226256">parent</a><span>|</span><a href="#39226505">next</a><span>|</span><label class="collapse" for="c-39226282">[-]</label><label class="expand" for="c-39226282">[3 more]</label></div><br/><div class="children"><div class="content">Isn&#x27;t that normally the premise of testing? Eg writing Python functions to test other Python functions?</div><br/><div id="39226332" class="c"><input type="checkbox" id="c-39226332" checked=""/><div class="controls bullet"><span class="by">aurareturn</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226282">parent</a><span>|</span><a href="#39226505">next</a><span>|</span><label class="collapse" for="c-39226332">[-]</label><label class="expand" for="c-39226332">[2 more]</label></div><br/><div class="children"><div class="content">Yes but Python is nice to write. Postgres functions are not. At least not to me.</div><br/><div id="39226379" class="c"><input type="checkbox" id="c-39226379" checked=""/><div class="controls bullet"><span class="by">maxbond</span><span>|</span><a href="#39225945">root</a><span>|</span><a href="#39226332">parent</a><span>|</span><a href="#39226505">next</a><span>|</span><label class="collapse" for="c-39226379">[-]</label><label class="expand" for="c-39226379">[1 more]</label></div><br/><div class="children"><div class="content">Depending on what kind of deployment you have, you could use Tcl, Rust, or even Python if you could use untrusted extensions. (Not a comment on this particularly testing framework, but Postgres server-side programming more generally.)<p>But I hear you, PgSQL can be very annoying and unergonomic, and it&#x27;s not a language most people you&#x27;re hiring will know upfront. Pushing things onto the backend isn&#x27;t unreasonable. When I write tests for PgSQL, I write them in Python and run them from the client side, not on the server.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="39226505" class="c"><input type="checkbox" id="c-39226505" checked=""/><div class="controls bullet"><span class="by">ilikerashers</span><span>|</span><a href="#39225945">parent</a><span>|</span><a href="#39226105">prev</a><span>|</span><a href="#39226038">next</a><span>|</span><label class="collapse" for="c-39226505">[-]</label><label class="expand" for="c-39226505">[1 more]</label></div><br/><div class="children"><div class="content">Oracle also lets you run Java from stored procedures which I’m sure lets you tie yourself in knots too.
There could be slim use cases for doing everything in the db but there’s a reason why it’s not widespread.</div><br/></div></div><div id="39226038" class="c"><input type="checkbox" id="c-39226038" checked=""/><div class="controls bullet"><span class="by">samaysharma</span><span>|</span><a href="#39225945">parent</a><span>|</span><a href="#39226505">prev</a><span>|</span><a href="#39226461">next</a><span>|</span><label class="collapse" for="c-39226038">[-]</label><label class="expand" for="c-39226038">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for the feedback. We&#x27;re actively working on implementing the pricing page for our website. It should be out in the next few days.</div><br/></div></div></div></div><div id="39226461" class="c"><input type="checkbox" id="c-39226461" checked=""/><div class="controls bullet"><span class="by">wokwokwok</span><span>|</span><a href="#39225945">prev</a><span>|</span><a href="#39226108">next</a><span>|</span><label class="collapse" for="c-39226461">[-]</label><label class="expand" for="c-39226461">[2 more]</label></div><br/><div class="children"><div class="content">&gt; We were able to build a data warehouse that is easy to maintain, and easy to reason about, and quick to onboard new engineers.<p>A data warehouse?<p>Ingesting raw data != a data warehouse.<p>I presume their cron jobs are significantly more complicated than that, implementing their domain logic in functions, which will not scale well into an easy to maintain system over time as all database function implementations do… or, what they’ve built is something…<p>…but that thing is not a data warehouse. It’s just a database.</div><br/><div id="39226621" class="c"><input type="checkbox" id="c-39226621" checked=""/><div class="controls bullet"><span class="by">sverhagen</span><span>|</span><a href="#39226461">parent</a><span>|</span><a href="#39226108">next</a><span>|</span><label class="collapse" for="c-39226621">[-]</label><label class="expand" for="c-39226621">[1 more]</label></div><br/><div class="children"><div class="content">&quot;Others might have a data warehouse, but we get by on Postgres&quot; ;)<p>(PS, I love Postgres.)</div><br/></div></div></div></div><div id="39226108" class="c"><input type="checkbox" id="c-39226108" checked=""/><div class="controls bullet"><span class="by">draven</span><span>|</span><a href="#39226461">prev</a><span>|</span><a href="#39225715">next</a><span>|</span><label class="collapse" for="c-39226108">[-]</label><label class="expand" for="c-39226108">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m always amazed (and a bit frightened) by the amount of logic that can be implemented directly in the database. How is the code debugged &#x2F; managed &#x2F; versioned &#x2F; deployed ? I would be thankful for any pointer to books &#x2F; blog posts about that.</div><br/><div id="39226554" class="c"><input type="checkbox" id="c-39226554" checked=""/><div class="controls bullet"><span class="by">Timshel</span><span>|</span><a href="#39226108">parent</a><span>|</span><a href="#39226369">next</a><span>|</span><label class="collapse" for="c-39226554">[-]</label><label class="expand" for="c-39226554">[1 more]</label></div><br/><div class="children"><div class="content">For the versionning part there is usually tools in your language. For ex: Flyway for java, diesel_migration for rust ...</div><br/></div></div><div id="39226369" class="c"><input type="checkbox" id="c-39226369" checked=""/><div class="controls bullet"><span class="by">docapotamus</span><span>|</span><a href="#39226108">parent</a><span>|</span><a href="#39226554">prev</a><span>|</span><a href="#39225715">next</a><span>|</span><label class="collapse" for="c-39226369">[-]</label><label class="expand" for="c-39226369">[1 more]</label></div><br/><div class="children"><div class="content">I personally put some logic in the database especially when I’m expressing constraints. If it’s there it means another engineer can’t go directly to the database to bypass these constraints. (By logic, I’m meaning for example a transaction can only transition between states if it’s in a required state).<p>When it comes to debugging, versioning, deployment all these live alongside the code and are managed via migrations. Testing it is done as an integration test with the rest of the system.<p>It helps that we don’t use an ORM and deal with SQL everywhere.</div><br/></div></div></div></div><div id="39225715" class="c"><input type="checkbox" id="c-39225715" checked=""/><div class="controls bullet"><span class="by">fourfun</span><span>|</span><a href="#39226108">prev</a><span>|</span><label class="collapse" for="c-39225715">[-]</label><label class="expand" for="c-39225715">[1 more]</label></div><br/><div class="children"><div class="content">I definitely agree that using a tool like Fivetran is generally needless complexity when FDWs would get the job done.</div><br/></div></div></div></div></div></div></div></body></html>