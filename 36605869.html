<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1688634067077" as="style"/><link rel="stylesheet" href="styles.css?v=1688634067077"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a>Tell HN: People forget that you can stick any data at the end of a bash script</a> </div><div class="subtext"><span>BasedAnon</span> | <span>104 comments</span></div><br/><div><div id="36613131" class="c"><input type="checkbox" id="c-36613131" checked=""/><div class="controls bullet"><span class="by">lloeki</span><span>|</span><a href="#36606806">next</a><span>|</span><label class="collapse" for="c-36613131">[-]</label><label class="expand" for="c-36613131">[1 more]</label></div><br/><div class="children"><div class="content">Ha, turns out I just wrote this helper function a few weeks ago, inspired by Perl and Ruby:<p><pre><code>    #!&#x2F;usr&#x2F;bin&#x2F;env bash

    # read data starting from the provided section marker up to the next one or EOF
    function section() {
        local section=&quot;$1&quot;
        local source=&quot;${BASH_SOURCE[0]}&quot;
    
        awk &#x27;&#x2F;^__[A-Z0-9]+__$&#x2F;{f=0} f{print} &#x2F;^&#x27;&quot;${section}&quot;&#x27;$&#x2F;{f=1}&#x27; &quot;${source}&quot;
    }
    
    section __JSON__ | jq
    section __YAML__ | ruby -ryaml -e &#x27;p YAML.load(STDIN.read)&#x27;
    
    exit
    
    __JSON__
    { &quot;a&quot;: 1 }
    __YAML__
    b:
      - 1
      - 2
      - 3
</code></pre>
My only wish is that shellcheck had a directive to stop yelling at me starting at a certain line.</div><br/></div></div><div id="36606806" class="c"><input type="checkbox" id="c-36606806" checked=""/><div class="controls bullet"><span class="by">xg15</span><span>|</span><a href="#36613131">prev</a><span>|</span><a href="#36606872">next</a><span>|</span><label class="collapse" for="c-36606806">[-]</label><label class="expand" for="c-36606806">[26 more]</label></div><br/><div class="children"><div class="content">If you care less about space efficiency and more about maintainability of the script, you can also encode the binary as base64 and put an<p><pre><code>  echo &#x27;...base64 data...&#x27; | base64 -d &gt; somefile
</code></pre>
in your script.<p>Or add compression to reclaim at least some of the wasted space:<p><pre><code>  echo &#x27;...base64 gzipped data...&#x27; | base64 -d | gunzip &gt; somefile
</code></pre>
Also note that bash accepts line breaks in quoted strings and the base64 utility has an &quot;ignore garbage&quot; option that lets it skip over e.g. whitespace in its input. You can use those to break up the base64 over multiple lines:<p><pre><code>  echo &#x27;
    ...base64 gzipped data...
    ...more data...
    ...even more data...
  &#x27; | base64 -di | gunzip &gt; somefile</code></pre></div><br/><div id="36607543" class="c"><input type="checkbox" id="c-36607543" checked=""/><div class="controls bullet"><span class="by">mike_hock</span><span>|</span><a href="#36606806">parent</a><span>|</span><a href="#36607844">next</a><span>|</span><label class="collapse" for="c-36607543">[-]</label><label class="expand" for="c-36607543">[3 more]</label></div><br/><div class="children"><div class="content">If you care about maintainability, you keep the binary data out of the source file and have a build process.</div><br/><div id="36612428" class="c"><input type="checkbox" id="c-36612428" checked=""/><div class="controls bullet"><span class="by">xg15</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36607543">parent</a><span>|</span><a href="#36609695">next</a><span>|</span><label class="collapse" for="c-36612428">[-]</label><label class="expand" for="c-36612428">[1 more]</label></div><br/><div class="children"><div class="content">I meant &quot;maintainability&quot; in the sense that you can open it in a text editor without either corrupting the file or having the editor crash.<p>It&#x27;s also useful if you want to check the file into a git repo and want to keep using the diff and merge tools.</div><br/></div></div><div id="36609695" class="c"><input type="checkbox" id="c-36609695" checked=""/><div class="controls bullet"><span class="by">dopidopHN</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36607543">parent</a><span>|</span><a href="#36612428">prev</a><span>|</span><a href="#36607844">next</a><span>|</span><label class="collapse" for="c-36609695">[-]</label><label class="expand" for="c-36609695">[1 more]</label></div><br/><div class="children"><div class="content">For something small. I would take a data.bin file rather than a build process. 
But yes.</div><br/></div></div></div></div><div id="36607844" class="c"><input type="checkbox" id="c-36607844" checked=""/><div class="controls bullet"><span class="by">saltcured</span><span>|</span><a href="#36606806">parent</a><span>|</span><a href="#36607543">prev</a><span>|</span><a href="#36608457">next</a><span>|</span><label class="collapse" for="c-36607844">[-]</label><label class="expand" for="c-36607844">[1 more]</label></div><br/><div class="children"><div class="content">You can also use here-documents to avoid hitting any argv length limits:<p><pre><code>    { base64 -d | gunzip &gt; output; } &lt;&lt;EOF12345
    ...data...
    EOF12345</code></pre></div><br/></div></div><div id="36608457" class="c"><input type="checkbox" id="c-36608457" checked=""/><div class="controls bullet"><span class="by">sudobash1</span><span>|</span><a href="#36606806">parent</a><span>|</span><a href="#36607844">prev</a><span>|</span><a href="#36612387">next</a><span>|</span><label class="collapse" for="c-36608457">[-]</label><label class="expand" for="c-36608457">[5 more]</label></div><br/><div class="children"><div class="content">An even simpler way would be to include a marker to denote the end of the shell script, and the start of the data. For example, if you put this in extract.sh<p><pre><code>    #!&#x2F;bin&#x2F;sh
    sed -E &#x27;1,&#x2F;^START-OF-TAR-DATA$&#x2F;d&#x27; &quot;$0&quot; | tar xvzf -
    exit
    START-OF-TAR-DATA
</code></pre>
and then run:<p><pre><code>    cat extract.sh ..&#x2F;foobar.tar.gz &gt; foobar.tar.gz.sh
</code></pre>
You can then run foobar.tar.gz.sh to self-extract. And you still get the benefit of being able to modify the shell script without needing to count lines or characters without sacrificing any compression.</div><br/><div id="36612401" class="c"><input type="checkbox" id="c-36612401" checked=""/><div class="controls bullet"><span class="by">oxygen_crisis</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36608457">parent</a><span>|</span><a href="#36612156">next</a><span>|</span><label class="collapse" for="c-36612401">[-]</label><label class="expand" for="c-36612401">[3 more]</label></div><br/><div class="children"><div class="content">You&#x27;ve already got a marker to denote the end of the shell script baked in there, it&#x27;s ^exit$</div><br/><div id="36612658" class="c"><input type="checkbox" id="c-36612658" checked=""/><div class="controls bullet"><span class="by">withinboredom</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36612401">parent</a><span>|</span><a href="#36612156">next</a><span>|</span><label class="collapse" for="c-36612658">[-]</label><label class="expand" for="c-36612658">[2 more]</label></div><br/><div class="children"><div class="content">There may be more than one exit.</div><br/><div id="36612830" class="c"><input type="checkbox" id="c-36612830" checked=""/><div class="controls bullet"><span class="by">oxygen_crisis</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36612658">parent</a><span>|</span><a href="#36612156">next</a><span>|</span><label class="collapse" for="c-36612830">[-]</label><label class="expand" for="c-36612830">[1 more]</label></div><br/><div class="children"><div class="content">There will be only one that is neither preceded by indentation nor followed by an exit code, so that it could match ^exit$, unless you contrive some hypothetical nonsense purely for the sake of contrarianism.<p>Any reasonable person will indent a conditional exit within the block testing its condition, and more than one unconditional exit doesn&#x27;t make sense.</div><br/></div></div></div></div></div></div></div></div><div id="36612387" class="c"><input type="checkbox" id="c-36612387" checked=""/><div class="controls bullet"><span class="by">snowstormsun</span><span>|</span><a href="#36606806">parent</a><span>|</span><a href="#36608457">prev</a><span>|</span><a href="#36608275">next</a><span>|</span><label class="collapse" for="c-36612387">[-]</label><label class="expand" for="c-36612387">[2 more]</label></div><br/><div class="children"><div class="content">Beware that often you need to append -n to echo to not include a newline when you base64 encode&#x2F;decode something.</div><br/><div id="36612468" class="c"><input type="checkbox" id="c-36612468" checked=""/><div class="controls bullet"><span class="by">xg15</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36612387">parent</a><span>|</span><a href="#36608275">next</a><span>|</span><label class="collapse" for="c-36612468">[-]</label><label class="expand" for="c-36612468">[1 more]</label></div><br/><div class="children"><div class="content">I think the -i flag when decoding should handle this and cause the decoder to skip the newlines.</div><br/></div></div></div></div><div id="36608275" class="c"><input type="checkbox" id="c-36608275" checked=""/><div class="controls bullet"><span class="by">AlDante2</span><span>|</span><a href="#36606806">parent</a><span>|</span><a href="#36612387">prev</a><span>|</span><a href="#36606842">next</a><span>|</span><label class="collapse" for="c-36608275">[-]</label><label class="expand" for="c-36608275">[3 more]</label></div><br/><div class="children"><div class="content">Just to be sure I’m following you correctly, what is the advantage of zipping the base64 data vs having the original binary, zipped if you like?</div><br/><div id="36612403" class="c"><input type="checkbox" id="c-36612403" checked=""/><div class="controls bullet"><span class="by">xg15</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36608275">parent</a><span>|</span><a href="#36609520">next</a><span>|</span><label class="collapse" for="c-36612403">[-]</label><label class="expand" for="c-36612403">[1 more]</label></div><br/><div class="children"><div class="content">The idea is to first zip the binary, then base64 the zipped data. Conversely, the script first decodes the base64 to a zipped binary, then unzips the binary.<p>It&#x27;s just to mitigate the wastefulness of base64 encoding. You end up with a file that is text editor friendly and not quite as bloated as directly encoding the binary would be - but of course the file is still larger than simply appending the binary directly like in the OP.<p>Also, if you don&#x27;t care about text editor friendlyness, you could indeed just zip the binary and then append it to the script for an even smaller file.</div><br/></div></div><div id="36609520" class="c"><input type="checkbox" id="c-36609520" checked=""/><div class="controls bullet"><span class="by">newx</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36608275">parent</a><span>|</span><a href="#36612403">prev</a><span>|</span><a href="#36606842">next</a><span>|</span><label class="collapse" for="c-36609520">[-]</label><label class="expand" for="c-36609520">[1 more]</label></div><br/><div class="children"><div class="content">As I understood, you base64 the zipped data on input and the other way around on output.<p>The reasoning being that the base64&#x27;d binary data is safe from being corrupted when the file is edited in text editors, as a response to the warning stated on the last paragraph of the original post.</div><br/></div></div></div></div><div id="36606842" class="c"><input type="checkbox" id="c-36606842" checked=""/><div class="controls bullet"><span class="by">dheera</span><span>|</span><a href="#36606806">parent</a><span>|</span><a href="#36608275">prev</a><span>|</span><a href="#36606872">next</a><span>|</span><label class="collapse" for="c-36606842">[-]</label><label class="expand" for="c-36606842">[11 more]</label></div><br/><div class="children"><div class="content">Is there an encoding that is less wasteful that base64 but not vulnerable to text editor corruption issues? I think avoiding 0x0 to 0x20 should be enough to not get corrupted by text editors, though base64 avoids a lot more than that.</div><br/><div id="36606956" class="c"><input type="checkbox" id="c-36606956" checked=""/><div class="controls bullet"><span class="by">ElectricalUnion</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36606842">parent</a><span>|</span><a href="#36607428">next</a><span>|</span><label class="collapse" for="c-36606956">[-]</label><label class="expand" for="c-36606956">[8 more]</label></div><br/><div class="children"><div class="content">If you can count on every printable ascii character being not-mangled, you can use ascii85&#x2F;base85&#x2F;Z85 (5 &quot;ascii characters&quot; to 4 bytes) instead of base64.</div><br/><div id="36607304" class="c"><input type="checkbox" id="c-36607304" checked=""/><div class="controls bullet"><span class="by">raverbashing</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36606956">parent</a><span>|</span><a href="#36607428">next</a><span>|</span><label class="collapse" for="c-36607304">[-]</label><label class="expand" for="c-36607304">[7 more]</label></div><br/><div class="children"><div class="content">There&#x27;s probably a base(bigger number) with Unicode chars today</div><br/><div id="36607420" class="c"><input type="checkbox" id="c-36607420" checked=""/><div class="controls bullet"><span class="by">bashinator</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36607304">parent</a><span>|</span><a href="#36607421">next</a><span>|</span><label class="collapse" for="c-36607420">[-]</label><label class="expand" for="c-36607420">[3 more]</label></div><br/><div class="children"><div class="content">base65536, and look who the author is :-D<p><a href="https:&#x2F;&#x2F;github.com&#x2F;qntm&#x2F;base65536">https:&#x2F;&#x2F;github.com&#x2F;qntm&#x2F;base65536</a></div><br/><div id="36607675" class="c"><input type="checkbox" id="c-36607675" checked=""/><div class="controls bullet"><span class="by">cassianoleal</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36607420">parent</a><span>|</span><a href="#36607421">next</a><span>|</span><label class="collapse" for="c-36607675">[-]</label><label class="expand" for="c-36607675">[2 more]</label></div><br/><div class="children"><div class="content">Who is the author?</div><br/><div id="36607864" class="c"><input type="checkbox" id="c-36607864" checked=""/><div class="controls bullet"><span class="by">yccs27</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36607675">parent</a><span>|</span><a href="#36607421">next</a><span>|</span><label class="collapse" for="c-36607864">[-]</label><label class="expand" for="c-36607864">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.qntm.org" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.qntm.org</a>
<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;from?site=qntm.org">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;from?site=qntm.org</a></div><br/></div></div></div></div></div></div><div id="36607421" class="c"><input type="checkbox" id="c-36607421" checked=""/><div class="controls bullet"><span class="by">CaptainFever</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36607304">parent</a><span>|</span><a href="#36607420">prev</a><span>|</span><a href="#36608471">next</a><span>|</span><label class="collapse" for="c-36607421">[-]</label><label class="expand" for="c-36607421">[1 more]</label></div><br/><div class="children"><div class="content">Base65536? <a href="https:&#x2F;&#x2F;github.com&#x2F;qntm&#x2F;base65536">https:&#x2F;&#x2F;github.com&#x2F;qntm&#x2F;base65536</a></div><br/></div></div><div id="36608471" class="c"><input type="checkbox" id="c-36608471" checked=""/><div class="controls bullet"><span class="by">sudobash1</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36607304">parent</a><span>|</span><a href="#36607421">prev</a><span>|</span><a href="#36609372">next</a><span>|</span><label class="collapse" for="c-36608471">[-]</label><label class="expand" for="c-36608471">[1 more]</label></div><br/><div class="children"><div class="content">But you need to make sure to use utf-16 or utf-32 instead of utf-8, or you may be worse off.</div><br/></div></div><div id="36609372" class="c"><input type="checkbox" id="c-36609372" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36607304">parent</a><span>|</span><a href="#36608471">prev</a><span>|</span><a href="#36607428">next</a><span>|</span><label class="collapse" for="c-36609372">[-]</label><label class="expand" for="c-36609372">[1 more]</label></div><br/><div class="children"><div class="content">While a couple of people suggested Base65536, that encoding isn&#x27;t particularly compact, and it can&#x27;t be as elegant as 65536 would suggest because it has to dodge special cases in unicode.<p>It&#x27;s almost always the case that <i>either</i> Base32768 is denser, or encodings with 2^17 or 2^20 characters are denser.</div><br/></div></div></div></div></div></div><div id="36607428" class="c"><input type="checkbox" id="c-36607428" checked=""/><div class="controls bullet"><span class="by">delusional</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36606842">parent</a><span>|</span><a href="#36606956">prev</a><span>|</span><a href="#36607177">next</a><span>|</span><label class="collapse" for="c-36607428">[-]</label><label class="expand" for="c-36607428">[1 more]</label></div><br/><div class="children"><div class="content">At that point you&#x27;re basically doing yEnc.</div><br/></div></div><div id="36607177" class="c"><input type="checkbox" id="c-36607177" checked=""/><div class="controls bullet"><span class="by">doublerabbit</span><span>|</span><a href="#36606806">root</a><span>|</span><a href="#36606842">parent</a><span>|</span><a href="#36607428">prev</a><span>|</span><a href="#36606872">next</a><span>|</span><label class="collapse" for="c-36607177">[-]</label><label class="expand" for="c-36607177">[1 more]</label></div><br/><div class="children"><div class="content">base16</div><br/></div></div></div></div></div></div><div id="36606872" class="c"><input type="checkbox" id="c-36606872" checked=""/><div class="controls bullet"><span class="by">dietrichepp</span><span>|</span><a href="#36606806">prev</a><span>|</span><a href="#36605952">next</a><span>|</span><label class="collapse" for="c-36606872">[-]</label><label class="expand" for="c-36606872">[8 more]</label></div><br/><div class="children"><div class="content">This trick is used in the demoscene. Instead of using -c, I use -n,<p><pre><code>  tail -n +2 $0
</code></pre>
The -n +2 option means “starting at line 2”, which is what you want if you cram your script into one line. You can make an executable packed with lzma this way,<p><pre><code>  a=`mktemp`;tail -n+2 $0|unxz&gt;$a;chmod +x $a;$a;rm $a;exit
</code></pre>
This is the polite way to do it, using mktemp. You can save some bytes if you don’t care about that stuff.</div><br/><div id="36609080" class="c"><input type="checkbox" id="c-36609080" checked=""/><div class="controls bullet"><span class="by">londons_explore</span><span>|</span><a href="#36606872">parent</a><span>|</span><a href="#36605952">next</a><span>|</span><label class="collapse" for="c-36609080">[-]</label><label class="expand" for="c-36609080">[7 more]</label></div><br/><div class="children"><div class="content">There must be a way to run something without needing a temp file...</div><br/><div id="36610375" class="c"><input type="checkbox" id="c-36610375" checked=""/><div class="controls bullet"><span class="by">dietrichepp</span><span>|</span><a href="#36606872">root</a><span>|</span><a href="#36609080">parent</a><span>|</span><a href="#36610733">next</a><span>|</span><label class="collapse" for="c-36610375">[-]</label><label class="expand" for="c-36610375">[1 more]</label></div><br/><div class="children"><div class="content">Yes. You can load the decompressed code into memory, mprotect() it to give it execution permissions, then jump in. Hard to do in a shell, though.</div><br/></div></div><div id="36610733" class="c"><input type="checkbox" id="c-36610733" checked=""/><div class="controls bullet"><span class="by">10000truths</span><span>|</span><a href="#36606872">root</a><span>|</span><a href="#36609080">parent</a><span>|</span><a href="#36610375">prev</a><span>|</span><a href="#36610077">next</a><span>|</span><label class="collapse" for="c-36610733">[-]</label><label class="expand" for="c-36610733">[2 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re willing assume a Linux platform and a Python installation, you can do something like:<p><pre><code>  echo -n &quot;base64encodedelf&quot; | base64 --decode | python3 -c &#x27;import os;import sys;f=os.memfd_create(os.MFD_CLOEXEC);os.write(f,sys.stdin.buffer.read());os.execve(f,[&quot;dummy&quot;],[])&#x27;</code></pre></div><br/><div id="36612475" class="c"><input type="checkbox" id="c-36612475" checked=""/><div class="controls bullet"><span class="by">londons_explore</span><span>|</span><a href="#36606872">root</a><span>|</span><a href="#36610733">parent</a><span>|</span><a href="#36610077">next</a><span>|</span><label class="collapse" for="c-36612475">[-]</label><label class="expand" for="c-36612475">[1 more]</label></div><br/><div class="children"><div class="content">Surprising that no combination of bash symbols lets you do this.</div><br/></div></div></div></div><div id="36610077" class="c"><input type="checkbox" id="c-36610077" checked=""/><div class="controls bullet"><span class="by">BasedAnon</span><span>|</span><a href="#36606872">root</a><span>|</span><a href="#36609080">parent</a><span>|</span><a href="#36610733">prev</a><span>|</span><a href="#36605952">next</a><span>|</span><label class="collapse" for="c-36610077">[-]</label><label class="expand" for="c-36610077">[3 more]</label></div><br/><div class="children"><div class="content">Basically everything in Linux will create a temp file one way or another even pipes. For you to take a binary and run it directly it has to have an inode. At best you can use Python &amp; the ctypes module to write a program into part of Python&#x27;s memory and trick it into continuing execution from there.</div><br/><div id="36612921" class="c"><input type="checkbox" id="c-36612921" checked=""/><div class="controls bullet"><span class="by">Denvercoder9</span><span>|</span><a href="#36606872">root</a><span>|</span><a href="#36610077">parent</a><span>|</span><a href="#36610359">next</a><span>|</span><label class="collapse" for="c-36612921">[-]</label><label class="expand" for="c-36612921">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Basically everything in Linux will create a temp file one way or another even pipes.<p>pipe(2) doesn&#x27;t create a file, at least not in the sense that I usually think about files (something that&#x27;s accessible through the filesystem).</div><br/></div></div><div id="36610359" class="c"><input type="checkbox" id="c-36610359" checked=""/><div class="controls bullet"><span class="by">dietrichepp</span><span>|</span><a href="#36606872">root</a><span>|</span><a href="#36610077">parent</a><span>|</span><a href="#36612921">prev</a><span>|</span><a href="#36605952">next</a><span>|</span><label class="collapse" for="c-36610359">[-]</label><label class="expand" for="c-36610359">[1 more]</label></div><br/><div class="children"><div class="content">Pipes are not temp files, they’re more like kernel buffers associated with no file. When I think of temp file, I think of something that is at least associated with a filesystem.<p>The reason that running a binary needs a file is because execve() takes a path as an argument. But, as you said, there are other ways to load code into memory.</div><br/></div></div></div></div></div></div></div></div><div id="36605952" class="c"><input type="checkbox" id="c-36605952" checked=""/><div class="controls bullet"><span class="by">jjgreen</span><span>|</span><a href="#36606872">prev</a><span>|</span><a href="#36612057">next</a><span>|</span><label class="collapse" for="c-36605952">[-]</label><label class="expand" for="c-36605952">[7 more]</label></div><br/><div class="children"><div class="content">Ruby (and earlier, Perl) formalised this with the __END__ section: <a href="https:&#x2F;&#x2F;www.honeybadger.io&#x2F;blog&#x2F;data-and-end-in-ruby&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.honeybadger.io&#x2F;blog&#x2F;data-and-end-in-ruby&#x2F;</a></div><br/><div id="36607028" class="c"><input type="checkbox" id="c-36607028" checked=""/><div class="controls bullet"><span class="by">francislavoie</span><span>|</span><a href="#36605952">parent</a><span>|</span><a href="#36610171">next</a><span>|</span><label class="collapse" for="c-36607028">[-]</label><label class="expand" for="c-36607028">[1 more]</label></div><br/><div class="children"><div class="content">PHP also has __halt_compiler() <a href="https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;en&#x2F;function.halt-compiler.php" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;en&#x2F;function.halt-compiler.php</a></div><br/></div></div><div id="36610171" class="c"><input type="checkbox" id="c-36610171" checked=""/><div class="controls bullet"><span class="by">throwawaaarrgh</span><span>|</span><a href="#36605952">parent</a><span>|</span><a href="#36607028">prev</a><span>|</span><a href="#36608353">next</a><span>|</span><label class="collapse" for="c-36610171">[-]</label><label class="expand" for="c-36610171">[1 more]</label></div><br/><div class="children"><div class="content">Back in the day I made a Perl script that would use an inline encryption algorithm to decode a payload and execute it in memory so it would never hit the disk. Data after the __DATA__ line.</div><br/></div></div><div id="36608353" class="c"><input type="checkbox" id="c-36608353" checked=""/><div class="controls bullet"><span class="by">brasic</span><span>|</span><a href="#36605952">parent</a><span>|</span><a href="#36610171">prev</a><span>|</span><a href="#36606900">next</a><span>|</span><label class="collapse" for="c-36608353">[-]</label><label class="expand" for="c-36608353">[3 more]</label></div><br/><div class="children"><div class="content">Are you sure that Perl took it from ruby and not the other way around?<p>(edit: a subsequent correction has obsoleted this comment)</div><br/><div id="36608584" class="c"><input type="checkbox" id="c-36608584" checked=""/><div class="controls bullet"><span class="by">vram22</span><span>|</span><a href="#36605952">root</a><span>|</span><a href="#36608353">parent</a><span>|</span><a href="#36606900">next</a><span>|</span><label class="collapse" for="c-36608584">[-]</label><label class="expand" for="c-36608584">[2 more]</label></div><br/><div class="children"><div class="content">They said &quot;earlier, Perl&quot;.</div><br/></div></div></div></div><div id="36606900" class="c"><input type="checkbox" id="c-36606900" checked=""/><div class="controls bullet"><span class="by">x86x87</span><span>|</span><a href="#36605952">parent</a><span>|</span><a href="#36608353">prev</a><span>|</span><a href="#36612057">next</a><span>|</span><label class="collapse" for="c-36606900">[-]</label><label class="expand" for="c-36606900">[1 more]</label></div><br/><div class="children"><div class="content">yup. after that you can use the global var DATA to access the data injected after the __END__</div><br/></div></div></div></div><div id="36612057" class="c"><input type="checkbox" id="c-36612057" checked=""/><div class="controls bullet"><span class="by">febed</span><span>|</span><a href="#36605952">prev</a><span>|</span><a href="#36606700">next</a><span>|</span><label class="collapse" for="c-36612057">[-]</label><label class="expand" for="c-36612057">[1 more]</label></div><br/><div class="children"><div class="content">It’s better explained here:<p><a href="https:&#x2F;&#x2F;www.xmodulo.com&#x2F;embed-binary-file-bash-script.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.xmodulo.com&#x2F;embed-binary-file-bash-script.html</a></div><br/></div></div><div id="36606700" class="c"><input type="checkbox" id="c-36606700" checked=""/><div class="controls bullet"><span class="by">nottorp</span><span>|</span><a href="#36612057">prev</a><span>|</span><a href="#36607473">next</a><span>|</span><label class="collapse" for="c-36606700">[-]</label><label class="expand" for="c-36606700">[3 more]</label></div><br/><div class="children"><div class="content">Shell archive it was called? There used to be a lot of installers like that.</div><br/><div id="36606873" class="c"><input type="checkbox" id="c-36606873" checked=""/><div class="controls bullet"><span class="by">NovemberWhiskey</span><span>|</span><a href="#36606700">parent</a><span>|</span><a href="#36608673">next</a><span>|</span><label class="collapse" for="c-36606873">[-]</label><label class="expand" for="c-36606873">[1 more]</label></div><br/><div class="children"><div class="content">Yup; &quot;shar&quot; <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Shar" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Shar</a></div><br/></div></div><div id="36608673" class="c"><input type="checkbox" id="c-36608673" checked=""/><div class="controls bullet"><span class="by">linsomniac</span><span>|</span><a href="#36606700">parent</a><span>|</span><a href="#36606873">prev</a><span>|</span><a href="#36607473">next</a><span>|</span><label class="collapse" for="c-36608673">[-]</label><label class="expand" for="c-36608673">[1 more]</label></div><br/><div class="children"><div class="content">Minor nit: every &quot;shar&quot; I&#x27;ve seen (from distant memory) used a &quot;here document&quot; rather than appending (possibly binary) data to the end of a shell script.<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Here_document" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Here_document</a></div><br/></div></div></div></div><div id="36607473" class="c"><input type="checkbox" id="c-36607473" checked=""/><div class="controls bullet"><span class="by">twic</span><span>|</span><a href="#36606700">prev</a><span>|</span><a href="#36611920">next</a><span>|</span><label class="collapse" for="c-36607473">[-]</label><label class="expand" for="c-36607473">[3 more]</label></div><br/><div class="children"><div class="content">Since zip files use a directory at the end, you can make a kind of mullet file - script at the front, archive at the back. I generated single-file runnable Java binaries like that at once point.</div><br/><div id="36608463" class="c"><input type="checkbox" id="c-36608463" checked=""/><div class="controls bullet"><span class="by">ndsipa_pomu</span><span>|</span><a href="#36607473">parent</a><span>|</span><a href="#36611920">next</a><span>|</span><label class="collapse" for="c-36608463">[-]</label><label class="expand" for="c-36608463">[2 more]</label></div><br/><div class="children"><div class="content">&gt; mullet file<p>That&#x27;s a great expression</div><br/><div id="36610344" class="c"><input type="checkbox" id="c-36610344" checked=""/><div class="controls bullet"><span class="by">BonoboIO</span><span>|</span><a href="#36607473">root</a><span>|</span><a href="#36608463">parent</a><span>|</span><a href="#36611920">next</a><span>|</span><label class="collapse" for="c-36610344">[-]</label><label class="expand" for="c-36610344">[1 more]</label></div><br/><div class="children"><div class="content">In German that would be VokuHila: 
Vorne Kurz, Hinten Lang<p>Front Short, Back Long<p><a href="https:&#x2F;&#x2F;de.wikipedia.org&#x2F;wiki&#x2F;Vokuhila" rel="nofollow noreferrer">https:&#x2F;&#x2F;de.wikipedia.org&#x2F;wiki&#x2F;Vokuhila</a></div><br/></div></div></div></div></div></div><div id="36611920" class="c"><input type="checkbox" id="c-36611920" checked=""/><div class="controls bullet"><span class="by">Gabrys1</span><span>|</span><a href="#36607473">prev</a><span>|</span><a href="#36612143">next</a><span>|</span><label class="collapse" for="c-36611920">[-]</label><label class="expand" for="c-36611920">[1 more]</label></div><br/><div class="children"><div class="content">&quot;$0&quot; otherwise it won&#x27;t work for paths with spaces</div><br/></div></div><div id="36612143" class="c"><input type="checkbox" id="c-36612143" checked=""/><div class="controls bullet"><span class="by">OnlyMortal</span><span>|</span><a href="#36611920">prev</a><span>|</span><a href="#36608664">next</a><span>|</span><label class="collapse" for="c-36612143">[-]</label><label class="expand" for="c-36612143">[1 more]</label></div><br/><div class="children"><div class="content">One “naughty” thing you can do is write invisible data into the last block of a file…<p>- truncate the file to extend it to the end of the last block<p>- write data to that area<p>- truncate the file back to its original size<p>An edit of that file will likely lose you data though.</div><br/></div></div><div id="36608664" class="c"><input type="checkbox" id="c-36608664" checked=""/><div class="controls bullet"><span class="by">mbreese</span><span>|</span><a href="#36612143">prev</a><span>|</span><a href="#36608234">next</a><span>|</span><label class="collapse" for="c-36608664">[-]</label><label class="expand" for="c-36608664">[5 more]</label></div><br/><div class="children"><div class="content">Java JAR files are similar, but reversed. You can add anything you want to the beginning of the JAR file (or is it <i>any</i> ZIP file?) so long as it doesn&#x27;t include the Zip file header &quot;PK&quot;. So, I use this to prepend a bash script that ultimately calls<p><pre><code>    java -jar $0
</code></pre>
It makes it very easy to setup and use Java based command line programs on a server.</div><br/><div id="36608877" class="c"><input type="checkbox" id="c-36608877" checked=""/><div class="controls bullet"><span class="by">zmmmmm</span><span>|</span><a href="#36608664">parent</a><span>|</span><a href="#36608234">next</a><span>|</span><label class="collapse" for="c-36608877">[-]</label><label class="expand" for="c-36608877">[4 more]</label></div><br/><div class="children"><div class="content">this sounds incredibly useful but I couldn&#x27;t get it to work. I just get<p><pre><code>    java.util.zip.ZipException: invalid CEN header (bad signature)
        at java.base&#x2F;java.util.zip.ZipFile$Source.zerror(ZipFile.java:1623)
</code></pre>
if I try to do anything with a JAR file that has leading text. I&#x27;m creating it just using<p><pre><code>   echo &#x27;java -jar $0&#x27; | cat - test.jar &gt; test.run.jar
</code></pre>
Is there more to it?</div><br/><div id="36609406" class="c"><input type="checkbox" id="c-36609406" checked=""/><div class="controls bullet"><span class="by">nneonneo</span><span>|</span><a href="#36608664">root</a><span>|</span><a href="#36608877">parent</a><span>|</span><a href="#36609994">next</a><span>|</span><label class="collapse" for="c-36609406">[-]</label><label class="expand" for="c-36609406">[1 more]</label></div><br/><div class="children"><div class="content">Technically, you should update the offset to the central directory in the Zip footer, along with the offsets to each file header in each central directory entry. If you don’t, the zip file reader has to apply some heuristics to locate the central directory; not all readers implement these heuristics, and those that do won’t always be robust.<p>The “unzip” utility can be useful as a sanity check; run “unzip -t” to test the integrity of the file.</div><br/></div></div><div id="36609994" class="c"><input type="checkbox" id="c-36609994" checked=""/><div class="controls bullet"><span class="by">mbreese</span><span>|</span><a href="#36608664">root</a><span>|</span><a href="#36608877">parent</a><span>|</span><a href="#36609406">prev</a><span>|</span><a href="#36609288">next</a><span>|</span><label class="collapse" for="c-36609994">[-]</label><label class="expand" for="c-36609994">[1 more]</label></div><br/><div class="children"><div class="content">Did you add a shebang line?<p>I have a small bash stub that I use. It’s roughly (I also add JAVA_OPTS, etc…):<p><pre><code>    #!&#x2F;bin&#x2F;bash
    java -jar $0
</code></pre>
Then…<p><pre><code>    cat stub.sh myproject.jar &gt; myexec
</code></pre>
See: <a href="https:&#x2F;&#x2F;github.com&#x2F;compgen-io&#x2F;ngsutilsj&#x2F;blob&#x2F;master&#x2F;src&#x2F;scripts&#x2F;stub.sh">https:&#x2F;&#x2F;github.com&#x2F;compgen-io&#x2F;ngsutilsj&#x2F;blob&#x2F;master&#x2F;src&#x2F;scri...</a></div><br/></div></div><div id="36609288" class="c"><input type="checkbox" id="c-36609288" checked=""/><div class="controls bullet"><span class="by">SeanA208</span><span>|</span><a href="#36608664">root</a><span>|</span><a href="#36608877">parent</a><span>|</span><a href="#36609994">prev</a><span>|</span><a href="#36608234">next</a><span>|</span><label class="collapse" for="c-36609288">[-]</label><label class="expand" for="c-36609288">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;puniverse&#x2F;capsule&#x2F;blob&#x2F;master&#x2F;capsule-util&#x2F;src&#x2F;main&#x2F;resources&#x2F;capsule&#x2F;execheader.sh">https:&#x2F;&#x2F;github.com&#x2F;puniverse&#x2F;capsule&#x2F;blob&#x2F;master&#x2F;capsule-uti...</a><p>This is what the (now defunkt) Capsule project prepends to get this same effect</div><br/></div></div></div></div></div></div><div id="36608234" class="c"><input type="checkbox" id="c-36608234" checked=""/><div class="controls bullet"><span class="by">norir</span><span>|</span><a href="#36608664">prev</a><span>|</span><a href="#36609243">next</a><span>|</span><label class="collapse" for="c-36608234">[-]</label><label class="expand" for="c-36608234">[9 more]</label></div><br/><div class="children"><div class="content">This is a great trick, but no one should ever run someone else&#x27;s script that does this unless they have verified the script line by line beforehand.</div><br/><div id="36609190" class="c"><input type="checkbox" id="c-36609190" checked=""/><div class="controls bullet"><span class="by">michaelcampbell</span><span>|</span><a href="#36608234">parent</a><span>|</span><a href="#36608952">next</a><span>|</span><label class="collapse" for="c-36609190">[-]</label><label class="expand" for="c-36609190">[6 more]</label></div><br/><div class="children"><div class="content">Maybe?  People run all manner of binaries&#x2F;installers without checking them; I&#x27;m not sure why these sorts of things require any EXTRA scrutiny.</div><br/><div id="36610120" class="c"><input type="checkbox" id="c-36610120" checked=""/><div class="controls bullet"><span class="by">fargle</span><span>|</span><a href="#36608234">root</a><span>|</span><a href="#36609190">parent</a><span>|</span><a href="#36608952">next</a><span>|</span><label class="collapse" for="c-36610120">[-]</label><label class="expand" for="c-36610120">[5 more]</label></div><br/><div class="children"><div class="content">EXACTLY! I can&#x27;t stand the overblown security posturing with regards to things like bash and git, even python.<p>When everyone in the world <i>INCLUDING</i> cyber-security professionals seems to think that it&#x27;s perfectly OK to download setup.exe or install.msi from sketchy driver mfgs. and run them. But SHARs and curl | sh is too scary!<p>It&#x27;s not that any of these are a good idea, it&#x27;s the blind-spot to traditional binary installers that&#x27;s annoying. How do you audit them? Why are they OK (because they <i>have</i> to be)</div><br/><div id="36610308" class="c"><input type="checkbox" id="c-36610308" checked=""/><div class="controls bullet"><span class="by">oefrha</span><span>|</span><a href="#36608234">root</a><span>|</span><a href="#36610120">parent</a><span>|</span><a href="#36608952">next</a><span>|</span><label class="collapse" for="c-36610308">[-]</label><label class="expand" for="c-36610308">[4 more]</label></div><br/><div class="children"><div class="content">curl | sh is actually bad because a completely innocuous script can become dangerous with a network hiccup, e.g.<p><pre><code>  rm -rf &#x2F;path&#x2F;to&#x2F;directory
</code></pre>
becomes<p><pre><code>  rm -rf &#x2F;path
</code></pre>
if the connection accidentally drops half way. Or something less dramatic, but still leaving you in a broken state.<p>Some people took the “don’t curl | sh” advice as “you have to inspect every line of a shell script installer you download”, which is of course absurd.</div><br/><div id="36612542" class="c"><input type="checkbox" id="c-36612542" checked=""/><div class="controls bullet"><span class="by">reactormonk</span><span>|</span><a href="#36608234">root</a><span>|</span><a href="#36610308">parent</a><span>|</span><a href="#36611120">next</a><span>|</span><label class="collapse" for="c-36612542">[-]</label><label class="expand" for="c-36612542">[1 more]</label></div><br/><div class="children"><div class="content">Or a malicious server trying to detect if you&#x27;re using `curl | sh` <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=17636032">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=17636032</a></div><br/></div></div><div id="36611120" class="c"><input type="checkbox" id="c-36611120" checked=""/><div class="controls bullet"><span class="by">ElectricalUnion</span><span>|</span><a href="#36608234">root</a><span>|</span><a href="#36610308">parent</a><span>|</span><a href="#36612542">prev</a><span>|</span><a href="#36610458">next</a><span>|</span><label class="collapse" for="c-36611120">[-]</label><label class="expand" for="c-36611120">[1 more]</label></div><br/><div class="children"><div class="content">Ideally, scripts that are in any danger of being truncated are supposed to be wrapped in immediately invoked functions exactly because of this gotcha, and most (but not all) of those that I inspect before running often are.</div><br/></div></div><div id="36610458" class="c"><input type="checkbox" id="c-36610458" checked=""/><div class="controls bullet"><span class="by">fargle</span><span>|</span><a href="#36608234">root</a><span>|</span><a href="#36610308">parent</a><span>|</span><a href="#36611120">prev</a><span>|</span><a href="#36608952">next</a><span>|</span><label class="collapse" for="c-36610458">[-]</label><label class="expand" for="c-36610458">[1 more]</label></div><br/><div class="children"><div class="content">that&#x27;s a very interesting point and example. TCP is normally lossless and byte-for-byte before data is forwarded to the application. I think your example may illustrate a loophole - truncation.<p>It&#x27;d only work if, like your example, it was the truncation that caused the flub. You can&#x27;t have random corruption.<p>Does curl in a pipeline really behave that way - if the connection is interrupted (TCP RESET), does it just end the pipe? It probably actually does, from what I see.<p>It&#x27;s an interesting edge case.<p>Personally I use, which would seem more immune:<p><pre><code>    curl -o &#x2F;tmp&#x2F;a
    vi &#x2F;tmp&#x2F;a
    {get bored easily, fuckit}
    sh &#x2F;tmp&#x2F;a</code></pre></div><br/></div></div></div></div></div></div></div></div><div id="36608952" class="c"><input type="checkbox" id="c-36608952" checked=""/><div class="controls bullet"><span class="by">ygjb</span><span>|</span><a href="#36608234">parent</a><span>|</span><a href="#36609190">prev</a><span>|</span><a href="#36609675">next</a><span>|</span><label class="collapse" for="c-36608952">[-]</label><label class="expand" for="c-36608952">[1 more]</label></div><br/><div class="children"><div class="content">Sure, but that&#x27;s turtles all the way down... any time you run untrusted code, you are making a risk based decision, usually based on the provenance of the code.</div><br/></div></div><div id="36609675" class="c"><input type="checkbox" id="c-36609675" checked=""/><div class="controls bullet"><span class="by">mook</span><span>|</span><a href="#36608234">parent</a><span>|</span><a href="#36608952">prev</a><span>|</span><a href="#36609243">next</a><span>|</span><label class="collapse" for="c-36609675">[-]</label><label class="expand" for="c-36609675">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think I&#x27;ve ever read through the Nvidia binary drivers that way. (They&#x27;re named *.run but are basically shar files)</div><br/></div></div></div></div><div id="36609243" class="c"><input type="checkbox" id="c-36609243" checked=""/><div class="controls bullet"><span class="by">rubicks</span><span>|</span><a href="#36608234">prev</a><span>|</span><a href="#36607156">next</a><span>|</span><label class="collapse" for="c-36609243">[-]</label><label class="expand" for="c-36609243">[1 more]</label></div><br/><div class="children"><div class="content">See also:<p><a href="https:&#x2F;&#x2F;makeself.io&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;makeself.io&#x2F;</a><p><a href="https:&#x2F;&#x2F;manpages.debian.org&#x2F;bookworm&#x2F;sharutils&#x2F;shar.1.en.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;manpages.debian.org&#x2F;bookworm&#x2F;sharutils&#x2F;shar.1.en.htm...</a></div><br/></div></div><div id="36607156" class="c"><input type="checkbox" id="c-36607156" checked=""/><div class="controls bullet"><span class="by">JohnFen</span><span>|</span><a href="#36609243">prev</a><span>|</span><a href="#36608097">next</a><span>|</span><label class="collapse" for="c-36607156">[-]</label><label class="expand" for="c-36607156">[6 more]</label></div><br/><div class="children"><div class="content">This is my default approach to writing installers for the Unices. The program is compressed and added to the end of the script, and the script does the unpacking and any needed setup&#x2F;configuration for the specific platform it&#x27;s getting installed on.<p>I don&#x27;t append it in binary form, though. I uuencode it. That way, there is no danger in using text editors.</div><br/><div id="36607317" class="c"><input type="checkbox" id="c-36607317" checked=""/><div class="controls bullet"><span class="by">themerone</span><span>|</span><a href="#36607156">parent</a><span>|</span><a href="#36608097">next</a><span>|</span><label class="collapse" for="c-36607317">[-]</label><label class="expand" for="c-36607317">[5 more]</label></div><br/><div class="children"><div class="content">Why uuencode? Base64 is the defacto standard these days.</div><br/><div id="36607717" class="c"><input type="checkbox" id="c-36607717" checked=""/><div class="controls bullet"><span class="by">JohnFen</span><span>|</span><a href="#36607156">root</a><span>|</span><a href="#36607317">parent</a><span>|</span><a href="#36607559">next</a><span>|</span><label class="collapse" for="c-36607717">[-]</label><label class="expand" for="c-36607717">[1 more]</label></div><br/><div class="children"><div class="content">Sorry, I did mean base64. I have a bad habit of calling all &quot;binary as text&quot; encodings &quot;uuencode&quot;. I usually catch myself before I put it in writing, though.</div><br/></div></div><div id="36607559" class="c"><input type="checkbox" id="c-36607559" checked=""/><div class="controls bullet"><span class="by">vram22</span><span>|</span><a href="#36607156">root</a><span>|</span><a href="#36607317">parent</a><span>|</span><a href="#36607717">prev</a><span>|</span><a href="#36608097">next</a><span>|</span><label class="collapse" for="c-36607559">[-]</label><label class="expand" for="c-36607559">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve used both, but only briefly. I think I used uuencode when using uucp. 
And Base64 in one of my Python programs.<p>What are their pros and cons, in your opinion?</div><br/><div id="36607640" class="c"><input type="checkbox" id="c-36607640" checked=""/><div class="controls bullet"><span class="by">themerone</span><span>|</span><a href="#36607156">root</a><span>|</span><a href="#36607559">parent</a><span>|</span><a href="#36608097">next</a><span>|</span><label class="collapse" for="c-36607640">[-]</label><label class="expand" for="c-36607640">[2 more]</label></div><br/><div class="children"><div class="content">Base 64 is slightly more space efficient.  Other than that it&#x27;s just more popular and better supported.</div><br/><div id="36608487" class="c"><input type="checkbox" id="c-36608487" checked=""/><div class="controls bullet"><span class="by">vram22</span><span>|</span><a href="#36607156">root</a><span>|</span><a href="#36607640">parent</a><span>|</span><a href="#36608097">next</a><span>|</span><label class="collapse" for="c-36608487">[-]</label><label class="expand" for="c-36608487">[1 more]</label></div><br/><div class="children"><div class="content">Got it, thanks.<p>Yes, uuencode &#x2F; uudecode are probably older too.<p>They are from the uucp dialup comms era of networking.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="36608097" class="c"><input type="checkbox" id="c-36608097" checked=""/><div class="controls bullet"><span class="by">heresie-dabord</span><span>|</span><a href="#36607156">prev</a><span>|</span><a href="#36606399">next</a><span>|</span><label class="collapse" for="c-36608097">[-]</label><label class="expand" for="c-36608097">[1 more]</label></div><br/><div class="children"><div class="content">In Perl, __DATA__ indicates the beginning of the data section of the file. A portable way to provide test data or sample data.<p><a href="https:&#x2F;&#x2F;perldoc.perl.org&#x2F;functions&#x2F;__DATA__" rel="nofollow noreferrer">https:&#x2F;&#x2F;perldoc.perl.org&#x2F;functions&#x2F;__DATA__</a></div><br/></div></div><div id="36606399" class="c"><input type="checkbox" id="c-36606399" checked=""/><div class="controls bullet"><span class="by">eadler</span><span>|</span><a href="#36608097">prev</a><span>|</span><a href="#36606099">next</a><span>|</span><label class="collapse" for="c-36606399">[-]</label><label class="expand" for="c-36606399">[2 more]</label></div><br/><div class="children"><div class="content">See <a href="https:&#x2F;&#x2F;man.freebsd.org&#x2F;cgi&#x2F;man.cgi?query=shar&amp;sektion=1&amp;format=html" rel="nofollow noreferrer">https:&#x2F;&#x2F;man.freebsd.org&#x2F;cgi&#x2F;man.cgi?query=shar&amp;sektion=1&amp;for...</a> for a tool to generate these types of archives.</div><br/><div id="36606595" class="c"><input type="checkbox" id="c-36606595" checked=""/><div class="controls bullet"><span class="by">teddyh</span><span>|</span><a href="#36606399">parent</a><span>|</span><a href="#36606099">next</a><span>|</span><label class="collapse" for="c-36606595">[-]</label><label class="expand" for="c-36606595">[1 more]</label></div><br/><div class="children"><div class="content">Also on GNU&#x2F;Linux systems: &lt;<a href="https:&#x2F;&#x2F;manpages.debian.org&#x2F;stable&#x2F;sharutils&#x2F;shar.1.en.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;manpages.debian.org&#x2F;stable&#x2F;sharutils&#x2F;shar.1.en.html</a>&gt;</div><br/></div></div></div></div><div id="36606099" class="c"><input type="checkbox" id="c-36606099" checked=""/><div class="controls bullet"><span class="by">cocodill</span><span>|</span><a href="#36606399">prev</a><span>|</span><a href="#36607000">next</a><span>|</span><label class="collapse" for="c-36606099">[-]</label><label class="expand" for="c-36606099">[6 more]</label></div><br/><div class="children"><div class="content">I can vaguely remember that many programs used to install themselves this way under Linux.</div><br/><div id="36606609" class="c"><input type="checkbox" id="c-36606609" checked=""/><div class="controls bullet"><span class="by">teddyh</span><span>|</span><a href="#36606099">parent</a><span>|</span><a href="#36607246">next</a><span>|</span><label class="collapse" for="c-36606609">[-]</label><label class="expand" for="c-36606609">[2 more]</label></div><br/><div class="children"><div class="content">It was used on Unix systems even before that.</div><br/><div id="36607255" class="c"><input type="checkbox" id="c-36607255" checked=""/><div class="controls bullet"><span class="by">dekhn</span><span>|</span><a href="#36606099">root</a><span>|</span><a href="#36606609">parent</a><span>|</span><a href="#36607246">next</a><span>|</span><label class="collapse" for="c-36607255">[-]</label><label class="expand" for="c-36607255">[1 more]</label></div><br/><div class="children"><div class="content">definitely used something similar on VAX&#x2F;VMS called VMS_SHARE (<a href="https:&#x2F;&#x2F;www.glaver.org&#x2F;ftp&#x2F;multinet-contributed-software&#x2F;vms_share&#x2F;vms_share.user_guide" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.glaver.org&#x2F;ftp&#x2F;multinet-contributed-software&#x2F;vms...</a>) circa &#x27;90-91<p>in fact I found an old archive of mine floating around on usenet and wrote a python script to unpack it.  Looking at the original, it was using a scripting. language bootstrap to make a COM script unpack  embedded the original code.</div><br/></div></div></div></div><div id="36607246" class="c"><input type="checkbox" id="c-36607246" checked=""/><div class="controls bullet"><span class="by">a2tech</span><span>|</span><a href="#36606099">parent</a><span>|</span><a href="#36606609">prev</a><span>|</span><a href="#36606767">next</a><span>|</span><label class="collapse" for="c-36607246">[-]</label><label class="expand" for="c-36607246">[1 more]</label></div><br/><div class="children"><div class="content">Lots of commercial Linux software use this still for installing their stuff. It’s a neat trick</div><br/></div></div><div id="36606767" class="c"><input type="checkbox" id="c-36606767" checked=""/><div class="controls bullet"><span class="by">nerdponx</span><span>|</span><a href="#36606099">parent</a><span>|</span><a href="#36607246">prev</a><span>|</span><a href="#36607290">next</a><span>|</span><label class="collapse" for="c-36606767">[-]</label><label class="expand" for="c-36606767">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve seen it recently with the Conda and Mamba package managers.</div><br/></div></div></div></div><div id="36607000" class="c"><input type="checkbox" id="c-36607000" checked=""/><div class="controls bullet"><span class="by">INTPenis</span><span>|</span><a href="#36606099">prev</a><span>|</span><a href="#36607166">next</a><span>|</span><label class="collapse" for="c-36607000">[-]</label><label class="expand" for="c-36607000">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s how I made a bash backdoor once. It was just a script somewhere on the FS, until it unpacked itself and executed the rest of the rootkit.<p>Long story but trust me that I had good intentions.</div><br/></div></div><div id="36607166" class="c"><input type="checkbox" id="c-36607166" checked=""/><div class="controls bullet"><span class="by">onion2k</span><span>|</span><a href="#36607000">prev</a><span>|</span><a href="#36609611">next</a><span>|</span><label class="collapse" for="c-36607166">[-]</label><label class="expand" for="c-36607166">[4 more]</label></div><br/><div class="children"><div class="content">This reminds me of ZX Spectrum Basic where all the graphics, sound, and level layouts were defined using DATA lines at the end of the program.</div><br/><div id="36608293" class="c"><input type="checkbox" id="c-36608293" checked=""/><div class="controls bullet"><span class="by">antod</span><span>|</span><a href="#36607166">parent</a><span>|</span><a href="#36607391">next</a><span>|</span><label class="collapse" for="c-36608293">[-]</label><label class="expand" for="c-36608293">[2 more]</label></div><br/><div class="children"><div class="content">Or any machine code routines you wanted to POKE into memory.<p>A suppressed obscure part of my lizard brain secretly wishes I could just code for 8bit computers from the 80s, just with all the modern niceties like text editors, assemblers and emulators etc.</div><br/><div id="36612087" class="c"><input type="checkbox" id="c-36612087" checked=""/><div class="controls bullet"><span class="by">kamma4434</span><span>|</span><a href="#36607166">root</a><span>|</span><a href="#36608293">parent</a><span>|</span><a href="#36607391">next</a><span>|</span><label class="collapse" for="c-36612087">[-]</label><label class="expand" for="c-36612087">[1 more]</label></div><br/><div class="children"><div class="content">Me too!…</div><br/></div></div></div></div><div id="36607391" class="c"><input type="checkbox" id="c-36607391" checked=""/><div class="controls bullet"><span class="by">allarm</span><span>|</span><a href="#36607166">parent</a><span>|</span><a href="#36608293">prev</a><span>|</span><a href="#36609611">next</a><span>|</span><label class="collapse" for="c-36607391">[-]</label><label class="expand" for="c-36607391">[1 more]</label></div><br/><div class="children"><div class="content">You could also put the binary data in the first line of the Basic program after the ‘rem’ command, change the line number to 0 using the poke command, so that it’s not possible to edit this line. The second line would run the code using ‘randomize usr’. There were also fun tricks with control sequences, that would hide the ‘rem’ command and the line number, and put something like “Cracked by Bill Gilbert (c) 1982” instead. Gosh, why I still remember all this nonsense after all these years…</div><br/></div></div></div></div><div id="36609611" class="c"><input type="checkbox" id="c-36609611" checked=""/><div class="controls bullet"><span class="by">doktorhladnjak</span><span>|</span><a href="#36607166">prev</a><span>|</span><a href="#36610033">next</a><span>|</span><label class="collapse" for="c-36609611">[-]</label><label class="expand" for="c-36609611">[2 more]</label></div><br/><div class="children"><div class="content">This reminds me of a job I had 15+ years ago where we did code reviews by emailing files to one another with our changes. It worked like this with the first part of the file being a script and the end of the file being a base64 encoded zip of the changed files. We had tooling that would pack them, but unpacking was done by execution.<p>What could possibly go wrong with emailing executable scripts?</div><br/><div id="36612299" class="c"><input type="checkbox" id="c-36612299" checked=""/><div class="controls bullet"><span class="by">habibur</span><span>|</span><a href="#36609611">parent</a><span>|</span><a href="#36610033">next</a><span>|</span><label class="collapse" for="c-36612299">[-]</label><label class="expand" for="c-36612299">[1 more]</label></div><br/><div class="children"><div class="content">&gt; What could possibly go wrong with emailing executable scripts?<p>Server side malware filters will strip the attachment.</div><br/></div></div></div></div><div id="36610033" class="c"><input type="checkbox" id="c-36610033" checked=""/><div class="controls bullet"><span class="by">lakomen</span><span>|</span><a href="#36609611">prev</a><span>|</span><a href="#36609068">next</a><span>|</span><label class="collapse" for="c-36610033">[-]</label><label class="expand" for="c-36610033">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s also good for signed bash scripts.</div><br/></div></div><div id="36609068" class="c"><input type="checkbox" id="c-36609068" checked=""/><div class="controls bullet"><span class="by">karmicthreat</span><span>|</span><a href="#36610033">prev</a><span>|</span><a href="#36609849">next</a><span>|</span><label class="collapse" for="c-36609068">[-]</label><label class="expand" for="c-36609068">[1 more]</label></div><br/><div class="children"><div class="content">I did a similar thing for a lowish volume embedded product. The update files are just bash scripts with a tar file cat&#x27;d on them. The unit just looks for a particular file on an external flash drive to run and the bash script runs, copies off a tar and checks that it has the right hash. Super simple and flexible when customers need me to do something special. Like extract some specific log onto a flash drive.</div><br/></div></div><div id="36609849" class="c"><input type="checkbox" id="c-36609849" checked=""/><div class="controls bullet"><span class="by">mogwire</span><span>|</span><a href="#36609068">prev</a><span>|</span><a href="#36607167">next</a><span>|</span><label class="collapse" for="c-36609849">[-]</label><label class="expand" for="c-36609849">[1 more]</label></div><br/><div class="children"><div class="content">A very large Electronic Medical Records company shipped an extremely large shell script to us for an install.<p>Upon examination it contained binary data and a command to extract it to a file and then installed the application.<p>This was the “efficient” way to ship and install the binary.</div><br/></div></div><div id="36607167" class="c"><input type="checkbox" id="c-36607167" checked=""/><div class="controls bullet"><span class="by">vram22</span><span>|</span><a href="#36609849">prev</a><span>|</span><a href="#36609361">next</a><span>|</span><label class="collapse" for="c-36607167">[-]</label><label class="expand" for="c-36607167">[2 more]</label></div><br/><div class="children"><div class="content">BASIC and Perl had or have something like that too.<p>IIRC, Perl copied it from BASIC, because BASIC came much before Perl.<p>And, again, IIRC, I&#x27;ve read about the shar (shell archive) method that someone else commented about in this thread (and which even has a Wikipedia entry), in either the classic Kernighan and Pike book, The Unix Programming Environment (which I&#x27;ve recommended here multiple times before), or in some Unix man pages, long ago.<p>So it&#x27;s quite an old method.</div><br/><div id="36610746" class="c"><input type="checkbox" id="c-36610746" checked=""/><div class="controls bullet"><span class="by">nurettin</span><span>|</span><a href="#36607167">parent</a><span>|</span><a href="#36609361">next</a><span>|</span><label class="collapse" for="c-36610746">[-]</label><label class="expand" for="c-36610746">[1 more]</label></div><br/><div class="children"><div class="content">I remember writing DATA lines on commodore basic. But you could put them on any line.</div><br/></div></div></div></div><div id="36609361" class="c"><input type="checkbox" id="c-36609361" checked=""/><div class="controls bullet"><span class="by">jmclnx</span><span>|</span><a href="#36607167">prev</a><span>|</span><a href="#36609086">next</a><span>|</span><label class="collapse" for="c-36609361">[-]</label><label class="expand" for="c-36609361">[1 more]</label></div><br/><div class="children"><div class="content">This for any sh type script, not just bash :) Will work with sh, ksh and even [t]csh</div><br/></div></div><div id="36609086" class="c"><input type="checkbox" id="c-36609086" checked=""/><div class="controls bullet"><span class="by">not2b</span><span>|</span><a href="#36609361">prev</a><span>|</span><a href="#36607810">next</a><span>|</span><label class="collapse" for="c-36609086">[-]</label><label class="expand" for="c-36609086">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s what uuencode &#x2F; uudecode were once used for.</div><br/></div></div><div id="36607810" class="c"><input type="checkbox" id="c-36607810" checked=""/><div class="controls bullet"><span class="by">sumosudo</span><span>|</span><a href="#36609086">prev</a><span>|</span><a href="#36607340">next</a><span>|</span><label class="collapse" for="c-36607810">[-]</label><label class="expand" for="c-36607810">[1 more]</label></div><br/><div class="children"><div class="content">I use a fun little hack, a la awk:<p>```
#!&#x2F;usr&#x2F;local&#x2F;bin&#x2F;bash<p>echo &quot;HELLO&quot;<p>TAIL_REMOTE_MARKER=`awk &#x27;&#x2F;^__THE_REMOTE_PART__&#x2F;{flag=1;next}&#x2F;^__END_THE_REMOTE_PART__&#x2F;{flag=0;exit}flag&#x27; ${0}`<p>eval &quot;$TAIL_REMOTE_MARKER&quot;<p>exit 0<p>__THE_REMOTE_PART__<p>echo &quot;WORLD&quot;<p>__END_THE_REMOTE_PART__
```</div><br/></div></div><div id="36607340" class="c"><input type="checkbox" id="c-36607340" checked=""/><div class="controls bullet"><span class="by">davidw</span><span>|</span><a href="#36607810">prev</a><span>|</span><a href="#36609351">next</a><span>|</span><label class="collapse" for="c-36607340">[-]</label><label class="expand" for="c-36607340">[2 more]</label></div><br/><div class="children"><div class="content">I seem to recall that you can do the opposite as well: stash some extra data at the end of a binary file. The &#x27;tclkit&#x27; system used this to package up an executable with the scripts you wanted to ship.</div><br/><div id="36610819" class="c"><input type="checkbox" id="c-36610819" checked=""/><div class="controls bullet"><span class="by">giantrobot</span><span>|</span><a href="#36607340">parent</a><span>|</span><a href="#36609351">next</a><span>|</span><label class="collapse" for="c-36610819">[-]</label><label class="expand" for="c-36610819">[1 more]</label></div><br/><div class="children"><div class="content">The Löve game development framework packages games like this. The games are nominally Alia scripts but if you cat a zip file to the end of the Lua script the framework lets you access assets in that zip as if they were in the game&#x27;s cwd.<p>It&#x27;s a cool abstraction, during development you can have assets just living on the file system and then &quot;deploy&quot; a flat file that accesses those assets the same way.</div><br/></div></div></div></div><div id="36609351" class="c"><input type="checkbox" id="c-36609351" checked=""/><div class="controls bullet"><span class="by">zeroonetwothree</span><span>|</span><a href="#36607340">prev</a><span>|</span><a href="#36609201">next</a><span>|</span><label class="collapse" for="c-36609351">[-]</label><label class="expand" for="c-36609351">[1 more]</label></div><br/><div class="children"><div class="content">Von Neumann architecture to the extreme :)</div><br/></div></div><div id="36609201" class="c"><input type="checkbox" id="c-36609201" checked=""/><div class="controls bullet"><span class="by">RajT88</span><span>|</span><a href="#36609351">prev</a><span>|</span><a href="#36608460">next</a><span>|</span><label class="collapse" for="c-36609201">[-]</label><label class="expand" for="c-36609201">[3 more]</label></div><br/><div class="children"><div class="content">This is a malware technique.<p>I am not saying don&#x27;t do it.  But that is mostly where I see this type of trick.</div><br/><div id="36609506" class="c"><input type="checkbox" id="c-36609506" checked=""/><div class="controls bullet"><span class="by">hgsgm</span><span>|</span><a href="#36609201">parent</a><span>|</span><a href="#36608460">next</a><span>|</span><label class="collapse" for="c-36609506">[-]</label><label class="expand" for="c-36609506">[2 more]</label></div><br/><div class="children"><div class="content">Malware is about intent and consent, not executable format.</div><br/><div id="36613049" class="c"><input type="checkbox" id="c-36613049" checked=""/><div class="controls bullet"><span class="by">RajT88</span><span>|</span><a href="#36609201">root</a><span>|</span><a href="#36609506">parent</a><span>|</span><a href="#36608460">next</a><span>|</span><label class="collapse" for="c-36613049">[-]</label><label class="expand" for="c-36613049">[1 more]</label></div><br/><div class="children"><div class="content">Security software does not flag based on intent or consent.</div><br/></div></div></div></div></div></div><div id="36608460" class="c"><input type="checkbox" id="c-36608460" checked=""/><div class="controls bullet"><span class="by">thinkmusic2000</span><span>|</span><a href="#36609201">prev</a><span>|</span><label class="collapse" for="c-36608460">[-]</label><label class="expand" for="c-36608460">[1 more]</label></div><br/><div class="children"><div class="content">I used to do something similar for Windows executable files. Append a large file to the end as necessary.</div><br/></div></div></div></div></div></div></div></body></html>