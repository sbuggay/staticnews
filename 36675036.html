<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1689066068329" as="style"/><link rel="stylesheet" href="styles.css?v=1689066068329"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://lwn.net/Articles/934561/">XFS online filesystem check and repair</a> <span class="domain">(<a href="https://lwn.net">lwn.net</a>)</span></div><div class="subtext"><span>psxuaw</span> | <span>30 comments</span></div><br/><div><div id="36675450" class="c"><input type="checkbox" id="c-36675450" checked=""/><div class="controls bullet"><span class="by">hestefisk</span><span>|</span><a href="#36675430">next</a><span>|</span><label class="collapse" for="c-36675450">[-]</label><label class="expand" for="c-36675450">[21 more]</label></div><br/><div class="children"><div class="content">Is there any case where one would choose this over ext4 or even zfs?</div><br/><div id="36676385" class="c"><input type="checkbox" id="c-36676385" checked=""/><div class="controls bullet"><span class="by">keeperofdakeys</span><span>|</span><a href="#36675450">parent</a><span>|</span><a href="#36675632">next</a><span>|</span><label class="collapse" for="c-36676385">[-]</label><label class="expand" for="c-36676385">[2 more]</label></div><br/><div class="children"><div class="content">Compared to Ext4, I&#x27;ve always found XFS more consistent performance wise. Plus it doesn&#x27;t require a monthly FSCK which strikes you when you least want it. (Though Ext4 made this <i>way</i> faster than Ext3). XFS also gives you reflink - which is a game changer for some OPs tasks and backups.</div><br/><div id="36676726" class="c"><input type="checkbox" id="c-36676726" checked=""/><div class="controls bullet"><span class="by">esaym</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36676385">parent</a><span>|</span><a href="#36675632">next</a><span>|</span><label class="collapse" for="c-36676726">[-]</label><label class="expand" for="c-36676726">[1 more]</label></div><br/><div class="children"><div class="content">It does not require a monthly fsck. I&#x27;ve set mine to once every 6 months. Been running like that since 2006 or so on many systems. Just do: tune2fs -i 6m &#x2F;dev&#x2F;path&#x2F;to&#x2F;device</div><br/></div></div></div></div><div id="36675632" class="c"><input type="checkbox" id="c-36675632" checked=""/><div class="controls bullet"><span class="by">phsau</span><span>|</span><a href="#36675450">parent</a><span>|</span><a href="#36676385">prev</a><span>|</span><a href="#36675673">next</a><span>|</span><label class="collapse" for="c-36675632">[-]</label><label class="expand" for="c-36675632">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s workload dependent; XFS performs better for our database needs.</div><br/><div id="36676882" class="c"><input type="checkbox" id="c-36676882" checked=""/><div class="controls bullet"><span class="by">SkyMarshal</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36675632">parent</a><span>|</span><a href="#36675673">next</a><span>|</span><label class="collapse" for="c-36676882">[-]</label><label class="expand" for="c-36676882">[2 more]</label></div><br/><div class="children"><div class="content">Compared to Ext4 or ZFS?</div><br/><div id="36678214" class="c"><input type="checkbox" id="c-36678214" checked=""/><div class="controls bullet"><span class="by">abwizz</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36676882">parent</a><span>|</span><a href="#36675673">next</a><span>|</span><label class="collapse" for="c-36678214">[-]</label><label class="expand" for="c-36678214">[1 more]</label></div><br/><div class="children"><div class="content">i&#x27;d rekon cow fs performs somewhat poorly with db workload, so, both</div><br/></div></div></div></div></div></div><div id="36675673" class="c"><input type="checkbox" id="c-36675673" checked=""/><div class="controls bullet"><span class="by">brucethemoose2</span><span>|</span><a href="#36675450">parent</a><span>|</span><a href="#36675632">prev</a><span>|</span><a href="#36675532">next</a><span>|</span><label class="collapse" for="c-36675673">[-]</label><label class="expand" for="c-36675673">[4 more]</label></div><br/><div class="children"><div class="content">zfs and xfs is apples to oranges. One is simple and low overhead, the other is stuffed with features and options.<p>ext4 gives me questionable performance with writing a huge amount (like 50k+) of small files, but other than that its great.</div><br/><div id="36675700" class="c"><input type="checkbox" id="c-36675700" checked=""/><div class="controls bullet"><span class="by">ericbarrett</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36675673">parent</a><span>|</span><a href="#36675532">next</a><span>|</span><label class="collapse" for="c-36675700">[-]</label><label class="expand" for="c-36675700">[3 more]</label></div><br/><div class="children"><div class="content">ext4 also blocks for a long time when deleting a large file, which can be bad in a production environment (think DROP TABLE in a database).</div><br/><div id="36676198" class="c"><input type="checkbox" id="c-36676198" checked=""/><div class="controls bullet"><span class="by">angrygoat</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36675700">parent</a><span>|</span><a href="#36677398">next</a><span>|</span><label class="collapse" for="c-36676198">[-]</label><label class="expand" for="c-36676198">[1 more]</label></div><br/><div class="children"><div class="content">this has a nasty side-effect with NFS, at least &lt;= version 3. ext4 immediately makes the file being unlinked invisible in the filesystem namespace, and then blocks while it does the work of deallocating the space.<p>the NFS client will issue the unlink() call, not hear anything back from the NFS server as it&#x27;s blocking doing the unlink(), and then eventually time out and retry the operation. at which point the server immediately will return ENOENT as the is no visible file at that path.<p>the annoying thing is that this interaction leaks through into userland programs, and then to users, who see &quot;no such file or directory&quot; errors which cause great confusion. I&#x27;ve seen this multiple times in HPC environments.</div><br/></div></div><div id="36677398" class="c"><input type="checkbox" id="c-36677398" checked=""/><div class="controls bullet"><span class="by">compsciphd</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36675700">parent</a><span>|</span><a href="#36676198">prev</a><span>|</span><a href="#36675532">next</a><span>|</span><label class="collapse" for="c-36677398">[-]</label><label class="expand" for="c-36677398">[1 more]</label></div><br/><div class="children"><div class="content">and much worse when fragmented on raid5.</div><br/></div></div></div></div></div></div><div id="36675532" class="c"><input type="checkbox" id="c-36675532" checked=""/><div class="controls bullet"><span class="by">postmodest</span><span>|</span><a href="#36675450">parent</a><span>|</span><a href="#36675673">prev</a><span>|</span><a href="#36676340">next</a><span>|</span><label class="collapse" for="c-36675532">[-]</label><label class="expand" for="c-36675532">[3 more]</label></div><br/><div class="children"><div class="content">On spinning rust, it had guaranteed bandwidth and multiple I&#x2F;O.<p>On NVME? Not really.</div><br/><div id="36675736" class="c"><input type="checkbox" id="c-36675736" checked=""/><div class="controls bullet"><span class="by">jeffbee</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36675532">parent</a><span>|</span><a href="#36676340">next</a><span>|</span><label class="collapse" for="c-36675736">[-]</label><label class="expand" for="c-36675736">[2 more]</label></div><br/><div class="children"><div class="content">On Linux, XFS never offered guaranteed-rate I&#x2F;O. It was really an IRIX feature that also required hardware support.</div><br/><div id="36676018" class="c"><input type="checkbox" id="c-36676018" checked=""/><div class="controls bullet"><span class="by">T3OU-736</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36675736">parent</a><span>|</span><a href="#36676340">next</a><span>|</span><label class="collapse" for="c-36676018">[-]</label><label class="expand" for="c-36676018">[1 more]</label></div><br/><div class="children"><div class="content">Fun story.<p>GRIO (Guaranteed Rate IO) XFS support was added to IRIX due to a request by a US Gov&#x27;t agency. This agency was doing electronic signal collection with IRIX on SGI HW, and wanted to a way to guarantee that whatever their sensors captured would be written to the storage media, no matter what else is going on at the OS level.</div><br/></div></div></div></div></div></div><div id="36676340" class="c"><input type="checkbox" id="c-36676340" checked=""/><div class="controls bullet"><span class="by">slyall</span><span>|</span><a href="#36675450">parent</a><span>|</span><a href="#36675532">prev</a><span>|</span><a href="#36676638">next</a><span>|</span><label class="collapse" for="c-36676340">[-]</label><label class="expand" for="c-36676340">[5 more]</label></div><br/><div class="children"><div class="content">ext4 is for when you have a simple file system and want something solid.<p>xfs is for when you have a big file system, maybe some some unusual loads but you want stability.<p>zfs is for when you want RAID and snapshots but are prepared to have it blow up every now and then.</div><br/><div id="36676887" class="c"><input type="checkbox" id="c-36676887" checked=""/><div class="controls bullet"><span class="by">SkyMarshal</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36676340">parent</a><span>|</span><a href="#36676638">next</a><span>|</span><label class="collapse" for="c-36676887">[-]</label><label class="expand" for="c-36676887">[4 more]</label></div><br/><div class="children"><div class="content"><i>&gt; but are prepared to have it blow up every now and then.</i><p>First time I&#x27;ve heard that about ZFS, is that really a thing?  It was made by Sun to be the ultimate industrial strength FS.</div><br/><div id="36677498" class="c"><input type="checkbox" id="c-36677498" checked=""/><div class="controls bullet"><span class="by">slyall</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36676887">parent</a><span>|</span><a href="#36677272">next</a><span>|</span><label class="collapse" for="c-36677498">[-]</label><label class="expand" for="c-36677498">[1 more]</label></div><br/><div class="children"><div class="content">Actually just realized all the examples I was thinking of were BTRFS.<p>Apologies to the ZFS people</div><br/></div></div><div id="36677272" class="c"><input type="checkbox" id="c-36677272" checked=""/><div class="controls bullet"><span class="by">ahartmetz</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36676887">parent</a><span>|</span><a href="#36677498">prev</a><span>|</span><a href="#36676638">next</a><span>|</span><label class="collapse" for="c-36677272">[-]</label><label class="expand" for="c-36677272">[2 more]</label></div><br/><div class="children"><div class="content">Might be missing a negation, then it&#x27;s a comparison to btrfs.<p>Me, I&#x27;m waiting for bcachefs - Linux native and carefully designed.</div><br/><div id="36677546" class="c"><input type="checkbox" id="c-36677546" checked=""/><div class="controls bullet"><span class="by">SubjectToChange</span><span>|</span><a href="#36675450">root</a><span>|</span><a href="#36677272">parent</a><span>|</span><a href="#36676638">next</a><span>|</span><label class="collapse" for="c-36677546">[-]</label><label class="expand" for="c-36677546">[1 more]</label></div><br/><div class="children"><div class="content">bcachefs will have its share of teething issues. Being merged into mainline is only the first step of a very long journey.</div><br/></div></div></div></div></div></div></div></div><div id="36676638" class="c"><input type="checkbox" id="c-36676638" checked=""/><div class="controls bullet"><span class="by">shmerl</span><span>|</span><a href="#36675450">parent</a><span>|</span><a href="#36676340">prev</a><span>|</span><a href="#36676458">next</a><span>|</span><label class="collapse" for="c-36676638">[-]</label><label class="expand" for="c-36676638">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;d ask the opposite, in what case would you choose ext4 over xfs? zfs is an another league, so not comparable.<p>If you need a robust, straightforward and fast filesystem - use xfs. If you need more advanced features - use btrfs or zfs. bcachefs should be an option for that at some point and unlike others it also aims to compete with xfs in speed.</div><br/></div></div><div id="36676458" class="c"><input type="checkbox" id="c-36676458" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#36675450">parent</a><span>|</span><a href="#36676638">prev</a><span>|</span><a href="#36675743">next</a><span>|</span><label class="collapse" for="c-36676458">[-]</label><label class="expand" for="c-36676458">[1 more]</label></div><br/><div class="children"><div class="content">If you need reflink or quotas.</div><br/></div></div><div id="36675743" class="c"><input type="checkbox" id="c-36675743" checked=""/><div class="controls bullet"><span class="by">donmcronald</span><span>|</span><a href="#36675450">parent</a><span>|</span><a href="#36676458">prev</a><span>|</span><a href="#36675430">next</a><span>|</span><label class="collapse" for="c-36675743">[-]</label><label class="expand" for="c-36675743">[1 more]</label></div><br/><div class="children"><div class="content">Maybe if you’re running MinIO?</div><br/></div></div></div></div><div id="36675430" class="c"><input type="checkbox" id="c-36675430" checked=""/><div class="controls bullet"><span class="by">colechristensen</span><span>|</span><a href="#36675450">prev</a><span>|</span><a href="#36676159">next</a><span>|</span><label class="collapse" for="c-36675430">[-]</label><label class="expand" for="c-36675430">[7 more]</label></div><br/><div class="children"><div class="content">Back in the day XFS was great and worked excellently and was quite resilient, performant, etc. etc... until it wasn&#x27;t.  If it got too full or somehow corrupted beyond its capacity to recover then you were just screwed and it was very difficult to actually get your data back.  Like it had a much higher threshold for being shitty and was great before you hit that threshold but after you hit it it was much worse than ext2&#x2F;3 or whatever else I was using.  Something around 80% full and it started to get awful and you risked losing your entire filesystem.<p>I&#x27;d have real reservations about knowingly using it again these days because of bad experiences, though this bias is based on really old experiences which are quite possibly no longer relevant.</div><br/><div id="36676173" class="c"><input type="checkbox" id="c-36676173" checked=""/><div class="controls bullet"><span class="by">linsomniac</span><span>|</span><a href="#36675430">parent</a><span>|</span><a href="#36675762">next</a><span>|</span><label class="collapse" for="c-36676173">[-]</label><label class="expand" for="c-36676173">[2 more]</label></div><br/><div class="children"><div class="content">I have two bad XFS experiences that stick out in my memory.  I like XFS, don&#x27;t get me wrong.<p>I ran XFS on our Linux distribution&#x2F;package mirror.  We ended up having some sort of error and the filesystem wouldn&#x27;t mount, so I tried running the fsck.  After around a day, it bombed out with out of memory.  I scrounged around, took down another server or two to max out the memory on the mirror server and eventually was able to get it to complete the fsck in a couple more days.<p>For a while I ran XFS on my laptop.  This was some Thinkpad that had fancy-pants graphics, and the graphics drivers made the system quite unstable  It would oops every 2-4 hours of normal use.  XFS had this bad habit at the time (long since fixed, IIRC) of reverting files to HOURS old data after the reboot.<p>A peer of this comment mentioned btrfs.  Around the same time I played around with btrfs.  For around a year I ran a couple of my company laptops on btrfs with zero problems.  Then, after one set of updates, both of them completely corrupted their filesystems.  I stopped using it, hoping that btrfs would fairly quickly stabilize, but have never ended up going back to it.  I love the idea of btrfs, but am a bit gun-shy.<p>I used Reiser extensively for map tile file-systems, largely because their idea of a &quot;small file&quot; was 1-2 orders of magnitude smaller than most other filesystems.  This particular use case was full world tiles, and a lot of them were solid blue (oceans, you know), I want to say 37 bytes.  My current gig puts tiles on XFS and it works great for that.<p>ZFS is a filesystem that has never let me down.  Performance can often be spotty, especially if you think you can use dedup, but I&#x27;ve had some pretty bad things happen to ZFS volumes and have never lost data on one of them.  It&#x27;s really the only place I&#x27;ll put archive data.  I&#x27;ve run a lot of backup servers using ZFS, even back in the days of zfsfuse, and it&#x27;s just been a workhorse.  Even in early days when zfsfuse had some pretty obscure bugs and would choke about every month or two.  Kudos to the zfs+fuse developers, they quickly tracked down every issue I ran into once I had a stress test use case going.<p>EXT has been a real workhorse too.  I&#x27;ve lost data, rarely, but considering it&#x27;s 99% of the filesystems I&#x27;ve run over the decades...  Pretty good track record.<p>Veritas vx on HP-UX was like a space age filesystem back in the mid &#x27;90s, but also was kind of painful.  My memories of it are just vague and bad.<p>I&#x27;d love to have HAMMER under Linux.  :-)<p>Ok, discuss!</div><br/><div id="36677891" class="c"><input type="checkbox" id="c-36677891" checked=""/><div class="controls bullet"><span class="by">SubjectToChange</span><span>|</span><a href="#36675430">root</a><span>|</span><a href="#36676173">parent</a><span>|</span><a href="#36675762">next</a><span>|</span><label class="collapse" for="c-36677891">[-]</label><label class="expand" for="c-36677891">[1 more]</label></div><br/><div class="children"><div class="content">I’ve been running btrfs on my laptop and workstation since 2015 and haven’t had any issues. I get all the advanced FS functionality I want without needing to worry about kernel versions or any of the other hassle of setting up ZFS.<p>In many ways ZFS feels like the last hurrah of “traditional” file systems. The fact that ZFS finds itself without genuine alternatives isn’t because it’s just <i>that good</i>, it’s because industry players have moved on. If all you need is a monster file server or a local data archive, sure, use ZFS.</div><br/></div></div></div></div><div id="36675762" class="c"><input type="checkbox" id="c-36675762" checked=""/><div class="controls bullet"><span class="by">butlerm</span><span>|</span><a href="#36675430">parent</a><span>|</span><a href="#36676173">prev</a><span>|</span><a href="#36676185">next</a><span>|</span><label class="collapse" for="c-36675762">[-]</label><label class="expand" for="c-36675762">[1 more]</label></div><br/><div class="children"><div class="content">That sounds like the experience a lot of people had with BTRFS (unfortunately).</div><br/></div></div><div id="36676185" class="c"><input type="checkbox" id="c-36676185" checked=""/><div class="controls bullet"><span class="by">pbh101</span><span>|</span><a href="#36675430">parent</a><span>|</span><a href="#36675762">prev</a><span>|</span><a href="#36676722">next</a><span>|</span><label class="collapse" for="c-36676185">[-]</label><label class="expand" for="c-36676185">[1 more]</label></div><br/><div class="children"><div class="content">In my experience enabling the finobt (free inode btree) setting made for a better experience under consistent capacity pressure. Context: CentOS 7, 7 TB RAID-10 SSD with ~100million files and ~4% churn rate per day, in production above 80% full for most of 5 years. Twice we experienced an XFS issue but xfs_repair got the FS back online and intact.</div><br/></div></div><div id="36676722" class="c"><input type="checkbox" id="c-36676722" checked=""/><div class="controls bullet"><span class="by">renewiltord</span><span>|</span><a href="#36675430">parent</a><span>|</span><a href="#36676185">prev</a><span>|</span><a href="#36676159">next</a><span>|</span><label class="collapse" for="c-36676722">[-]</label><label class="expand" for="c-36676722">[2 more]</label></div><br/><div class="children"><div class="content">Back in the early 2000s I had XFS zero out some files on power outage. Well known bug at the time. Fixed soon but retained the branding.<p>What a time. People would recommend ReiserFS back then. Big fan club.</div><br/><div id="36677137" class="c"><input type="checkbox" id="c-36677137" checked=""/><div class="controls bullet"><span class="by">adrian_b</span><span>|</span><a href="#36675430">root</a><span>|</span><a href="#36676722">parent</a><span>|</span><a href="#36676159">next</a><span>|</span><label class="collapse" for="c-36677137">[-]</label><label class="expand" for="c-36677137">[1 more]</label></div><br/><div class="children"><div class="content">Yes, it was very annoying and it happened even to files that were open only for reading, not for writing.<p>For me, &#x2F;etc&#x2F;fstab was zeroed a couple of times, which lead to a bricked system (before 2000).<p>Fortunately, this bug was eventually solved and I have been using XFS for more than twenty years on a great variety of hardware, with excellent results and no data loss whatsoever.</div><br/></div></div></div></div></div></div><div id="36676159" class="c"><input type="checkbox" id="c-36676159" checked=""/><div class="controls bullet"><span class="by">jeffbee</span><span>|</span><a href="#36675430">prev</a><span>|</span><label class="collapse" for="c-36676159">[-]</label><label class="expand" for="c-36676159">[1 more]</label></div><br/><div class="children"><div class="content">I find the whole concept slightly scary. Some reasons for an online filesystem consistency check to fail are that the hardware has lied to the operating system about the success of some past operation, the filesystem has gone down a bad road and written garbage to a storage device, or the checker and the filesystem are inconsistent, with uncertainty about which side is correct. Under all those conditions I think I want my system to halt and log. Continuing seems like a real bad idea.<p>There are fault-tolerant ways of coding operating systems and filesystem but it does not seem like those ways are practiced by Linux.</div><br/></div></div></div></div></div></div></div></body></html>