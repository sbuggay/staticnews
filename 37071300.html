<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1691658067940" as="style"/><link rel="stylesheet" href="styles.css?v=1691658067940"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://wiki.makerdiary.com/nrf52840-mdk-usb-dongle/guides/ble-sniffer/">Make a low-cost Bluetooth LE packet sniffer with Wireshark</a> <span class="domain">(<a href="https://wiki.makerdiary.com">wiki.makerdiary.com</a>)</span></div><div class="subtext"><span>Zelin</span> | <span>17 comments</span></div><br/><div><div id="37072782" class="c"><input type="checkbox" id="c-37072782" checked=""/><div class="controls bullet"><span class="by">minimalist</span><span>|</span><a href="#37072705">next</a><span>|</span><label class="collapse" for="c-37072782">[-]</label><label class="expand" for="c-37072782">[3 more]</label></div><br/><div class="children"><div class="content">Maybe someone can help me understand this. I&#x27;ve always shied away from smartwatches because the tracking potential. We have always known how the MAC address of wireless clients can be used to track a device and decades later, MAC randomization is being offered on major operating systems.<p>Why don&#x27;t I hear about that as much with bluetooth devices? Surely they suffer from the same problem? If not, how do devices remember each other?</div><br/><div id="37073135" class="c"><input type="checkbox" id="c-37073135" checked=""/><div class="controls bullet"><span class="by">andoma</span><span>|</span><a href="#37072782">parent</a><span>|</span><a href="#37073351">next</a><span>|</span><label class="collapse" for="c-37073135">[-]</label><label class="expand" for="c-37073135">[1 more]</label></div><br/><div class="children"><div class="content">Not an expert in the field, but I have some knowledge. Bluetooth specifies different address types [1] where one of the types are Resolvable Random Private Address. This is used to avoid tracking. TLDR: The address is periodically randomized (typically every 15 min). Part of the address is a hash that lets you identify the device if you previously have bonded with the device (so you have its Identity Resolving Key)<p>[1] <a href="https:&#x2F;&#x2F;novelbits.io&#x2F;bluetooth-address-privacy-ble&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;novelbits.io&#x2F;bluetooth-address-privacy-ble&#x2F;</a></div><br/></div></div><div id="37073351" class="c"><input type="checkbox" id="c-37073351" checked=""/><div class="controls bullet"><span class="by">abwizz</span><span>|</span><a href="#37072782">parent</a><span>|</span><a href="#37073135">prev</a><span>|</span><a href="#37072705">next</a><span>|</span><label class="collapse" for="c-37073351">[-]</label><label class="expand" for="c-37073351">[1 more]</label></div><br/><div class="children"><div class="content">bt is flaky enough as it is ;)<p>but yea, fwiw bt mac addresses are NOT randomized on google and apple platforms and serve as a constant identification provider for anyone that cares (e.g. retailers).<p>wifi macs are randomized for a few years now (settings toggle in hostapd.conf)</div><br/></div></div></div></div><div id="37072705" class="c"><input type="checkbox" id="c-37072705" checked=""/><div class="controls bullet"><span class="by">jvm___</span><span>|</span><a href="#37072782">prev</a><span>|</span><a href="#37073152">next</a><span>|</span><label class="collapse" for="c-37072705">[-]</label><label class="expand" for="c-37072705">[1 more]</label></div><br/><div class="children"><div class="content">There was a missing runner in Iowa who was eventually found in a corn field. I always wondered if some sort of Bluetooth sniffer could have found her smart watch if they&#x27;d canvassed the roads she was supposed to be on. Her body was 50-60ft off the road.</div><br/></div></div><div id="37073152" class="c"><input type="checkbox" id="c-37073152" checked=""/><div class="controls bullet"><span class="by">smackeyacky</span><span>|</span><a href="#37072705">prev</a><span>|</span><a href="#37071907">next</a><span>|</span><label class="collapse" for="c-37073152">[-]</label><label class="expand" for="c-37073152">[1 more]</label></div><br/><div class="children"><div class="content">You can also do this with the Ti cc2540, comes with bluetooth sniffing firmware.  You need a command line program in Linux to get the output to wireshark, but i find grabbing traffic and analysing afterwards more useful tham real time analysis anyway.</div><br/></div></div><div id="37071907" class="c"><input type="checkbox" id="c-37071907" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#37073152">prev</a><span>|</span><a href="#37072658">next</a><span>|</span><label class="collapse" for="c-37071907">[-]</label><label class="expand" for="c-37071907">[4 more]</label></div><br/><div class="children"><div class="content">I was looking in to BLE sniffing and was very surprised to learn this can&#x27;t be done with a typical Intel wifi+Bluetooth chip (like an ax201 for example).<p>Is this a hardware limitation, or a limitation of the Linux Bluetooth stack? Or maybe I&#x27;m just wrong?</div><br/><div id="37072373" class="c"><input type="checkbox" id="c-37072373" checked=""/><div class="controls bullet"><span class="by">montecarl</span><span>|</span><a href="#37071907">parent</a><span>|</span><a href="#37073108">next</a><span>|</span><label class="collapse" for="c-37072373">[-]</label><label class="expand" for="c-37072373">[1 more]</label></div><br/><div class="children"><div class="content">I an the sole developer of a product that uses bluetooth (classic not BLE) and have struggled so much with bluetooth (documentation and APIs just seem not that helpful or complete or are at such a low level that they aren&#x27;t useful unless you already know everything), but I will try to give an answer and hopefully if I am wrong someone can educate us.<p>My understanding is that most bluetooth devices interface with the operating system over a standardized host controller interface (HCI) over a UART or SPI interface. Basically the OS sends some standardized commands to the HCI and receives some data back. This means that the OS doesn&#x27;t have full control over the radio and are limited in what they can do to a set of standardized commands[1]. For example, even if you monitor everything that OS sends&#x2F;receives over this HCI channel (using, e.g. btmon on Linux) you will not see everything that is going on.<p>For example, with bluetooth classic, during inquiry (discovering pairable devices) you don&#x27;t really see all the details of what the device is doing. The hardware doesn&#x27;t seem to signal anything about a host devices scanning you and the reply packets that are sent. I was trying to debug some issues with Windows 11 not discovering my device (despite it being in inquiry scan mode and that my phone could see it but not my desktop) and btmon was totally unhelpful in this case and I believe it to be a limitation of how the OS and the bluetooth device communicate at a fundamental level. It turns out the answer to my particular issue was the &quot;class of device&quot; that my device reported wasn&#x27;t one that Windows 11 will show during pairing.<p>[1] <a href="https:&#x2F;&#x2F;software-dl.ti.com&#x2F;simplelink&#x2F;esd&#x2F;simplelink_cc13x2_sdk&#x2F;1.60.00.29_new&#x2F;exports&#x2F;docs&#x2F;ble5stack&#x2F;vendor_specific_guide&#x2F;BLE_Vendor_Specific_HCI_Guide&#x2F;hci_interface.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;software-dl.ti.com&#x2F;simplelink&#x2F;esd&#x2F;simplelink_cc13x2_...</a></div><br/></div></div><div id="37073108" class="c"><input type="checkbox" id="c-37073108" checked=""/><div class="controls bullet"><span class="by">ajb</span><span>|</span><a href="#37071907">parent</a><span>|</span><a href="#37072373">prev</a><span>|</span><a href="#37072237">next</a><span>|</span><label class="collapse" for="c-37073108">[-]</label><label class="expand" for="c-37073108">[1 more]</label></div><br/><div class="children"><div class="content">Bluetooth is a frequency hopping protocol. Most hardware is provisioned to access one channel at a time. In BLE, even the initial setup can happen over once of three channels. My understanding is that it&#x27;s difficult for a sniffer to work reliably (including the one in the OP) unless the hardware is provisioned to receive multiple channels. But I&#x27;m not an expert in it.</div><br/></div></div><div id="37072237" class="c"><input type="checkbox" id="c-37072237" checked=""/><div class="controls bullet"><span class="by">GuestHNUser</span><span>|</span><a href="#37071907">parent</a><span>|</span><a href="#37073108">prev</a><span>|</span><a href="#37072658">next</a><span>|</span><label class="collapse" for="c-37072237">[-]</label><label class="expand" for="c-37072237">[1 more]</label></div><br/><div class="children"><div class="content">I had this exact question a while ago. Closest answer I could find was this stackexchange post: <a href="https:&#x2F;&#x2F;superuser.com&#x2F;questions&#x2F;1708946&#x2F;why-do-bluetooth-packet-sniffing-tutorials-for-windows-require-an-adapter" rel="nofollow noreferrer">https:&#x2F;&#x2F;superuser.com&#x2F;questions&#x2F;1708946&#x2F;why-do-bluetooth-pac...</a></div><br/></div></div></div></div><div id="37072658" class="c"><input type="checkbox" id="c-37072658" checked=""/><div class="controls bullet"><span class="by">kallistisoft</span><span>|</span><a href="#37071907">prev</a><span>|</span><a href="#37071301">next</a><span>|</span><label class="collapse" for="c-37072658">[-]</label><label class="expand" for="c-37072658">[2 more]</label></div><br/><div class="children"><div class="content">Recently setup this up using the same board (nrf52840 usb dongle), it was a fun and cheap ($10 on mouser.com) mini-project. Learned a bunch about the ble protocol in the process :)</div><br/><div id="37073420" class="c"><input type="checkbox" id="c-37073420" checked=""/><div class="controls bullet"><span class="by">1231112315123</span><span>|</span><a href="#37072658">parent</a><span>|</span><a href="#37071301">next</a><span>|</span><label class="collapse" for="c-37073420">[-]</label><label class="expand" for="c-37073420">[1 more]</label></div><br/><div class="children"><div class="content">Just for people who got the non-makerdiary version of the nrf 52840 USB Dongle (note the &quot;MDK&quot; in the article&#x27;s dongle name):<p>For the non-MDK dongle, the reset button is a side-oriented button next to the big white button (almost looks like an LED). Took me a while.</div><br/></div></div></div></div><div id="37071301" class="c"><input type="checkbox" id="c-37071301" checked=""/><div class="controls bullet"><span class="by">Zelin</span><span>|</span><a href="#37072658">prev</a><span>|</span><label class="collapse" for="c-37071301">[-]</label><label class="expand" for="c-37071301">[5 more]</label></div><br/><div class="children"><div class="content">This is a useful tool for debugging and learning about Bluetooth Low Energy applications.</div><br/><div id="37072552" class="c"><input type="checkbox" id="c-37072552" checked=""/><div class="controls bullet"><span class="by">Bouncingsoul1</span><span>|</span><a href="#37071301">parent</a><span>|</span><a href="#37072091">next</a><span>|</span><label class="collapse" for="c-37072552">[-]</label><label class="expand" for="c-37072552">[3 more]</label></div><br/><div class="children"><div class="content">No it is not, IMO. These devices are only ever usefull if you have unencrypted connections, with peripherals with static addresses. Add either random addresses or encryption and you won&#x27;t have any success while debugging. So this tools are not usefull for 99% of peripherals you see around. 
These cheap tools can only operate on 1 frequency at a time. BLE Advertisments are done one 3 channels (37,38,39), you have to listen to all of them to get the init of the connection. With this cheap devices you have 66% you miss some parts of this and thus fail to follow the connection and encryption on the remaining 36 channel (BLE does dynamic channel hopping, the channel list is exchanged within the connection).
Plus with only 1 channel, it will sooner or later fail to follow the connection and this is usually just before you could repro the issue at hand.<p>Believe me if you want to do anything serious you have to invest some money. Up to BLE 4.2 i would suggest <a href="https:&#x2F;&#x2F;fte.com&#x2F;products&#x2F;bpalowenergy.aspx" rel="nofollow noreferrer">https:&#x2F;&#x2F;fte.com&#x2F;products&#x2F;bpalowenergy.aspx</a> which comes around 1000€. There is so no follow up for 5.0 (which more and more devices have now) so I have no suggestion there (unless you want to invest 10.000+++)</div><br/><div id="37072695" class="c"><input type="checkbox" id="c-37072695" checked=""/><div class="controls bullet"><span class="by">kallistisoft</span><span>|</span><a href="#37071301">root</a><span>|</span><a href="#37072552">parent</a><span>|</span><a href="#37072091">next</a><span>|</span><label class="collapse" for="c-37072695">[-]</label><label class="expand" for="c-37072695">[2 more]</label></div><br/><div class="children"><div class="content">Very much depends on what you&#x27;re trying to do... In my case I wanted to examine the raw traffic between two devices that I had written software for and had full control over. I found it worked just fine as the debug version of the code doesn&#x27;t implement any of the ble security features. Also had no issues using the dongle to examine ble 5.x traffic.</div><br/><div id="37072812" class="c"><input type="checkbox" id="c-37072812" checked=""/><div class="controls bullet"><span class="by">Bouncingsoul1</span><span>|</span><a href="#37071301">root</a><span>|</span><a href="#37072695">parent</a><span>|</span><a href="#37072091">next</a><span>|</span><label class="collapse" for="c-37072812">[-]</label><label class="expand" for="c-37072812">[1 more]</label></div><br/><div class="children"><div class="content">Yes thats true, but even if I have access to the device firmware, which I usually do, so I can build an unecrpyted version and this usually leads to the problem not being reproducible or showing differently...
Anyway I want to reproduce the problem as close to production fw as possible. So via our time&#x2F;effort calculation, spending some money on a multichannel sniffer was surely worth it.</div><br/></div></div></div></div></div></div><div id="37072091" class="c"><input type="checkbox" id="c-37072091" checked=""/><div class="controls bullet"><span class="by">nixgeek</span><span>|</span><a href="#37071301">parent</a><span>|</span><a href="#37072552">prev</a><span>|</span><label class="collapse" for="c-37072091">[-]</label><label class="expand" for="c-37072091">[1 more]</label></div><br/><div class="children"><div class="content">All your comments on LinkedIn seem to be shilling for nRF52840?</div><br/></div></div></div></div></div></div></div></div></div></body></html>